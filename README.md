# React

<p align="center"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="165.93" height="162" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 228"><path fill="#00D8FF" d="M210.483 73.824a171.49 171.49 0 0 0-8.24-2.597c.465-1.9.893-3.777 1.273-5.621c6.238-30.281 2.16-54.676-11.769-62.708c-13.355-7.7-35.196.329-57.254 19.526a171.23 171.23 0 0 0-6.375 5.848a155.866 155.866 0 0 0-4.241-3.917C100.759 3.829 77.587-4.822 63.673 3.233C50.33 10.957 46.379 33.89 51.995 62.588a170.974 170.974 0 0 0 1.892 8.48c-3.28.932-6.445 1.924-9.474 2.98C17.309 83.498 0 98.307 0 113.668c0 15.865 18.582 31.778 46.812 41.427a145.52 145.52 0 0 0 6.921 2.165a167.467 167.467 0 0 0-2.01 9.138c-5.354 28.2-1.173 50.591 12.134 58.266c13.744 7.926 36.812-.22 59.273-19.855a145.567 145.567 0 0 0 5.342-4.923a168.064 168.064 0 0 0 6.92 6.314c21.758 18.722 43.246 26.282 56.54 18.586c13.731-7.949 18.194-32.003 12.4-61.268a145.016 145.016 0 0 0-1.535-6.842c1.62-.48 3.21-.974 4.76-1.488c29.348-9.723 48.443-25.443 48.443-41.52c0-15.417-17.868-30.326-45.517-39.844Zm-6.365 70.984c-1.4.463-2.836.91-4.3 1.345c-3.24-10.257-7.612-21.163-12.963-32.432c5.106-11 9.31-21.767 12.459-31.957c2.619.758 5.16 1.557 7.61 2.4c23.69 8.156 38.14 20.213 38.14 29.504c0 9.896-15.606 22.743-40.946 31.14Zm-10.514 20.834c2.562 12.94 2.927 24.64 1.23 33.787c-1.524 8.219-4.59 13.698-8.382 15.893c-8.067 4.67-25.32-1.4-43.927-17.412a156.726 156.726 0 0 1-6.437-5.87c7.214-7.889 14.423-17.06 21.459-27.246c12.376-1.098 24.068-2.894 34.671-5.345a134.17 134.17 0 0 1 1.386 6.193ZM87.276 214.515c-7.882 2.783-14.16 2.863-17.955.675c-8.075-4.657-11.432-22.636-6.853-46.752a156.923 156.923 0 0 1 1.869-8.499c10.486 2.32 22.093 3.988 34.498 4.994c7.084 9.967 14.501 19.128 21.976 27.15a134.668 134.668 0 0 1-4.877 4.492c-9.933 8.682-19.886 14.842-28.658 17.94ZM50.35 144.747c-12.483-4.267-22.792-9.812-29.858-15.863c-6.35-5.437-9.555-10.836-9.555-15.216c0-9.322 13.897-21.212 37.076-29.293c2.813-.98 5.757-1.905 8.812-2.773c3.204 10.42 7.406 21.315 12.477 32.332c-5.137 11.18-9.399 22.249-12.634 32.792a134.718 134.718 0 0 1-6.318-1.979Zm12.378-84.26c-4.811-24.587-1.616-43.134 6.425-47.789c8.564-4.958 27.502 2.111 47.463 19.835a144.318 144.318 0 0 1 3.841 3.545c-7.438 7.987-14.787 17.08-21.808 26.988c-12.04 1.116-23.565 2.908-34.161 5.309a160.342 160.342 0 0 1-1.76-7.887Zm110.427 27.268a347.8 347.8 0 0 0-7.785-12.803c8.168 1.033 15.994 2.404 23.343 4.08c-2.206 7.072-4.956 14.465-8.193 22.045a381.151 381.151 0 0 0-7.365-13.322Zm-45.032-43.861c5.044 5.465 10.096 11.566 15.065 18.186a322.04 322.04 0 0 0-30.257-.006c4.974-6.559 10.069-12.652 15.192-18.18ZM82.802 87.83a323.167 323.167 0 0 0-7.227 13.238c-3.184-7.553-5.909-14.98-8.134-22.152c7.304-1.634 15.093-2.97 23.209-3.984a321.524 321.524 0 0 0-7.848 12.897Zm8.081 65.352c-8.385-.936-16.291-2.203-23.593-3.793c2.26-7.3 5.045-14.885 8.298-22.6a321.187 321.187 0 0 0 7.257 13.246c2.594 4.48 5.28 8.868 8.038 13.147Zm37.542 31.03c-5.184-5.592-10.354-11.779-15.403-18.433c4.902.192 9.899.29 14.978.29c5.218 0 10.376-.117 15.453-.343c-4.985 6.774-10.018 12.97-15.028 18.486Zm52.198-57.817c3.422 7.8 6.306 15.345 8.596 22.52c-7.422 1.694-15.436 3.058-23.88 4.071a382.417 382.417 0 0 0 7.859-13.026a347.403 347.403 0 0 0 7.425-13.565Zm-16.898 8.101a358.557 358.557 0 0 1-12.281 19.815a329.4 329.4 0 0 1-23.444.823c-7.967 0-15.716-.248-23.178-.732a310.202 310.202 0 0 1-12.513-19.846h.001a307.41 307.41 0 0 1-10.923-20.627a310.278 310.278 0 0 1 10.89-20.637l-.001.001a307.318 307.318 0 0 1 12.413-19.761c7.613-.576 15.42-.876 23.31-.876H128c7.926 0 15.743.303 23.354.883a329.357 329.357 0 0 1 12.335 19.695a358.489 358.489 0 0 1 11.036 20.54a329.472 329.472 0 0 1-11 20.722Zm22.56-122.124c8.572 4.944 11.906 24.881 6.52 51.026c-.344 1.668-.73 3.367-1.15 5.09c-10.622-2.452-22.155-4.275-34.23-5.408c-7.034-10.017-14.323-19.124-21.64-27.008a160.789 160.789 0 0 1 5.888-5.4c18.9-16.447 36.564-22.941 44.612-18.3ZM128 90.808c12.625 0 22.86 10.235 22.86 22.86s-10.235 22.86-22.86 22.86s-22.86-10.235-22.86-22.86s10.235-22.86 22.86-22.86Z"></path></svg></p>

#### [æ›´å¤šçš„ React è®¨è®º](https://github.com/reactwg/react-18/discussions)

### äº†è§£ React 18.x

- ğŸ¢ å£°æ˜å¼ç¼–å†™ UIã€Vueã€å°ç¨‹åºã€Reactã€Flutterã€‘å“åº”å¼ `UI = render(state)`
- ğŸ›Ÿ ç»„ä»¶åŒ–å¼€å‘

- ğŸ›µ ä½¿ç”¨ Node è¿›è¡ŒæœåŠ¡ç«¯æ¸²æŸ“(SSR)
- ğŸš ä½¿ç”¨ React Native å¼€å‘åŸç”Ÿç§»åŠ¨åº”ç”¨ç¨‹åº
- ğŸ‘ 2017 å¹´ Facebook æ¨å‡ºçš„ ReactVR, å¼€å‘è™šæ‹Ÿç°å® Web åº”ç”¨ç¨‹åº

**å¼€å‘ä¾èµ– ğŸ“ï¼š**

- reactï¼šæ ¸å¿ƒä»£ç 
- react-domï¼šæ¸²æŸ“ä¸åŒå¹³å°æ‰€éœ€çš„æ ¸å¿ƒä»£ç 
  - web ç«¯ï¼šreact-dom å°† jsx æœ€ç»ˆæ¸²æŸ“æˆçœŸå®çš„ DOM, æ˜¾ç¤ºæµè§ˆå™¨ä¸­
  - native ç«¯ï¼šreact-dom å°† jsx æœ€ç»ˆæ¸²æŸ“æˆåŸç”Ÿçš„ç§»åŠ¨ç¨‹åºæ§ä»¶
- babelï¼šjsx è½¬åŒ– react ä»£ç çš„å·¥å…·(jsx è¯­æ³•è½¬åŒ– React.creatElement)

```js
import React from "react";
import ReactDOM from "react-dom/client"; // æ³¨æ„å¯¼å‡ºè·¯å¾„

// Before 18.x
ReactDOM.render(<div>React</div>, document.querSelector("#root"));

// After 18.x
const app = ReactDOM.creatRoot(document.querSelector("#root"));
app.render(<div>React</div>);
```

#### **ç±» class å’Œå‡½æ•°å¼ç»„ä»¶ ğŸ“–**

**class ç»„ä»¶ï¼š**

```js
// é€šè¿‡ class å¹¶ä¸”ç»§æ‰¿ React.Component æ¥åˆ›å»ºç»„ä»¶
class App extends React.Component {
  // ...æ•°æ®åˆå§‹åŒ–,ç»§æ‰¿çˆ¶ç±»è°ƒç”¨(å¯é€‰ï¼šå¦‚æœä¸éœ€è¦åˆå§‹åŒ–æ•°æ®åˆ™ä¸éœ€è¦å®ç° constructor)
  constructor(props) {
    // è®©çˆ¶ç±»çš„æ„é€ å‡½æ•°ä¿å­˜å¥½ props, ä»¥ä¾¿åœ¨åé¢çš„æ–¹æ³•ä¸­ä½¿ç”¨(State ä¹Ÿæ˜¯å¦‚æ­¤)
    // ğŸš React é»˜è®¤ä¹Ÿä¼šå¸®åŠ©å¤„ç†ä¿å­˜ props, ä¸æ‰§è¡Œä»¥ä¸‹ä»£ç ä¹Ÿæ˜¯å¯ä»¥çš„
    super(props);

    // ...é€šå¸¸åœ¨è¿™é‡Œåˆå§‹åŒ– state
    // ...é€šå¸¸åœ¨è¿™é‡Œå¯¹ç»„ä»¶çš„æ–¹æ³• this æå‰ç»‘å®š
    this.handelClick = this.handelClick.bind(this);
  }

  // ...ç»„ä»¶æ–¹æ³•
  handelClick() {
    // react ä¼šå¯¹ this.setState() ä¼ å…¥çš„å¯¹è±¡è¿›è¡Œâ€œåˆå¹¶â€
    this.setState({ count: 1 });

    // âš ï¸ åœ¨å½“å‰å‡½æ•°è¢«è°ƒç”¨æ—¶, å‡½æ•°å†…çš„ this æŒ‡å‘ä¸ä¸€å®šæ˜¯å½“å‰ç»„ä»¶çš„å®ä¾‹å¯¹è±¡(ä½œä¸º jsx æ–¹æ³•å›è°ƒ(æŒ‡é’ˆä¼ é€’)é»˜è®¤æ˜¯ undefined), æ‰€ä»¥éœ€è¦æ‰‹åŠ¨ç»‘å®š this, æˆ–è€…ğŸŸ¢ä½¿ç”¨ react çš„å®éªŒæ€§è¯­æ³• class fields handelClick = () => {} , æˆ–è€…ğŸŸ¢zåœ¨ JSX ä¸­äº‹ä»¶å›è°ƒä¸­ä½¿ç”¨ç®­å¤´å‡½æ•°
    // e.g. setTimeout(this.handelClick, 1000); // Wrong
    // e.g. const app = new App(); const handelClick = app.handelClick; handelClick(); this æŒ‡å‘å°±ä¸æ˜¯ App çš„å®ä¾‹å¯¹è±¡
    // e.g. <button onClick={() => this.handelClick()}>Click me</button>
    // âš ï¸ setState æœ‰å¯èƒ½æ˜¯å¼‚æ­¥çš„,å‡ºäºæ€§èƒ½è€ƒè™‘,react ä¼šå°†å¤šä¸ª setState() çš„è°ƒç”¨åˆå¹¶æˆä¸€ä¸ª,æ‰€ä»¥åœ¨è¿™é‡Œä¸èƒ½ä¾èµ– this.state.count çš„å€¼æ¥æ›´æ–°
    this.setState({ count: this.state.count + 1 }); // Wrong

    // ğŸŸ¢ æ­£ç¡®çš„åšæ³•æ˜¯ä½¿åœ¨ setState ä¼ å…¥ä¸€ä¸ªå›è°ƒå‡½æ•°, åœ¨ setState(callback) ä¸­, callback çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸Šä¸€æ¬¡çš„ state, ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸Šä¸€æ¬¡çš„ props
    this.setState((state, props) => {
      return { count: state.count + 1 };
    }); // Correct
  }

  // ...æ¸²æŸ“å†…å®¹çš„ render æ–¹æ³•(class å”¯ä¸€å¿…é¡»è¦å®ç°çš„æ–¹æ³•) ,è¿”å›çš„ jsx å°±æ˜¯ react çš„è™šæ‹Ÿ DOM
  render() {
    return <div>{("any[]", "cannot be Object")}</div>;
  }
}
```

**å‡½æ•°å¼ï¼š**

```js
// åŒæ ·éœ€è¦å¤§å†™é©¼å³°å‘½å,ä¸éœ€è¦ç»§æ‰¿ React.Component
function App (){}

// ğŸ“ æ²¡æœ‰ Hook ä¸‹
- è™½ç„¶ä¼šè¢«æ›´æ–°æŒ‚è½½, ä½†æ˜¯æ²¡æœ‰ç”Ÿå‘½å‘¨æœŸ ğŸ¥½
- this å…³é”®å­—ä¸èƒ½æŒ‡å‘ç»„ä»¶å®ä¾‹(å› ä¸ºæ²¡æœ‰ç»„ä»¶å®ä¾‹)
- æ²¡æœ‰å†…éƒ¨çŠ¶æ€(State)
```

> Event
> event å¯¹è±¡ä¸åŸç”Ÿçš„ä¼ é€’æ–¹æ³•ç›¸ä¼¼ ,ä½†æ˜¯ React çš„ event å¯¹è±¡æ˜¯è¢« React å°è£…è¿‡çš„
>
> **React ä¸­å¦ä¸€ä¸ªä¸åŒç‚¹æ˜¯ä½ ä¸èƒ½é€šè¿‡è¿”å› false çš„æ–¹å¼é˜»æ­¢é»˜è®¤è¡Œä¸ºã€‚ä½ å¿…é¡»æ˜¾å¼çš„ä½¿ç”¨ preventDefault**
>
> **React 18.x å¼€å§‹ setState é»˜è®¤å¼‚æ­¥ ğŸ¢**

- event.preventDefault() é˜»æ­¢é»˜è®¤è¡Œä¸º(React éœ€è¦æ‰‹åŠ¨è°ƒç”¨é˜»æ­¢é»˜è®¤è¡Œä¸º)
- **bind ç»‘å®š this æ—¶éœ€è¦æ³¨æ„ å‚æ•°ä¼ é€’é—®é¢˜(bind åœ¨å¤šä¸ªå‚æ•°å­˜æ”¾ä½ç½®)**
- å½“éœ€è¦ä¼ é€’å¤šä¸ªå‚æ•°æ—¶ ,å»ºè®®åœ¨ jsx ä¸­ä½¿ç”¨ç®­å¤´å‡½æ•°

```js
// e.g.
<button onClick={this.handelClick.bind(this, 'å‚æ•°')}>Click me</button>

// æ­¤æ—¶ event å‚æ•°ä¼šè¢«ä¼ é€’åˆ° handelClick æ–¹æ³•ä¸­çš„ç¬¬äºŒä¸ªå‚æ•°ä¸­
handelClick(arg, event) {
  console.log(arg); // 'å‚æ•°'
}


// e.g.
handleClick = function (e) {
  console.log(this); // undefined
}

handleChange = handleClick.bind(this, 'å‚æ•°');
handleChange(event) // éœ€è¦åœ¨ç¬¬äºŒä¸ªå‚æ•°ä¸­æ‰èƒ½è·å– event å¯¹è±¡
```

**åˆ—è¡¨æ¸²æŸ“ ğŸ¥½ï¼š**

å…ƒç´ çš„ key åªæœ‰æ”¾åœ¨å°±è¿‘çš„æ•°ç»„ä¸Šä¸‹æ–‡ä¸­æ‰æœ‰æ„ä¹‰ã€‚
æ¯”æ–¹è¯´, å¦‚æœæå–å‡ºä¸€ä¸ª ListItem ç»„ä»¶, åº”è¯¥æŠŠ key ä¿ç•™åœ¨æ•°ç»„ä¸­çš„è¿™ä¸ª <ListItem /> å…ƒç´ ä¸Š, è€Œä¸æ˜¯æ”¾åœ¨ ListItem ç»„ä»¶ä¸­çš„ <li> å…ƒç´ ä¸Šã€‚

```js
function ListItem(props) {
  // æ­£ç¡®ï¼è¿™é‡Œä¸éœ€è¦æŒ‡å®š keyï¼š
  return <li>{props.value}</li>;
  // return <li key={ props.value }>{props.value}</li>;
}

function NumberList(props) {
  const numbers = props.numbers;
  const listItems = numbers.map((number) => (
    // æ­£ç¡®ï¼key åº”è¯¥åœ¨æ•°ç»„çš„ä¸Šä¸‹æ–‡ä¸­è¢«æŒ‡å®š
    <ListItem key={number.toString()} value={number} />
  ));
  return <ul>{listItems}</ul>;
}
```

> âš ï¸ ç»„ä»¶åç§°å¿…é¡»æ˜¯é¦–å­—æ¯å¤§å†™çš„é©¼å³°å‘½å , ä¾‹å¦‚ï¼š`<App />` , å¦åˆ™ react ä¼šè®¤ä¸ºæ˜¯åŸç”Ÿçš„ html æ ‡ç­¾

å¦‚ä½•å­˜æ”¾ç»„ä»¶çš„æ•°æ®å’Œæ–¹æ³•å‘¢ï¼Ÿ

- é€šè¿‡ `this.state` å­˜æ”¾çš„æ•°æ®é€šå¸¸æ˜¯éœ€è¦åŠ¨æ€æ›´æ–°çš„æ•°æ®
- é€šè¿‡ `this.props` å­˜æ”¾çš„æ•°æ®é€šå¸¸æ˜¯çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„æ•°æ®(åªè¯»)
- é€šè¿‡ `this.handelClick` å­˜æ”¾çš„æ–¹æ³•é€šå¸¸æ˜¯ç»„ä»¶çš„äº‹ä»¶å¤„ç†æ–¹æ³•(âš ï¸ this æŒ‡å‘é—®é¢˜)

`this.setState`åšäº†ä»€ä¹ˆï¼Ÿ

- æ›´æ–°ç»„ä»¶çš„ state
- è‡ªåŠ¨è°ƒç”¨ render æ–¹æ³•é‡æ–°æ¸²æŸ“ç»„ä»¶

**JSX è¯­æ³• ğŸ²ï¼š**
`JSX` æ˜¯ `JavaScript` çš„è¯­æ³•æ‰©å±•, ç”¨æ¥æè¿° `UI` çš„é•¿å¾—åƒ `HTML` , ä½†æ˜¯å®é™…ä¸Šæ˜¯ `JavaScript` è¯­æ³•çš„ä¸€ç§æ‰©å±•

> è½¬æ¢ï¼š`const element = <h1>ğŸš£</h1>` => `React.createElement('h1', null, 'ğŸš£')`
> element æ˜¯ä¸€ä¸ªå¯¹è±¡, æœ‰ type, props, key, ref ç­‰å±æ€§,å®ƒä¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ä¸æ˜¯ä¸€ä¸ª DOM å…ƒç´ ,å®ƒæ˜¯ä¸€ä¸ªæè¿° DOM å…ƒç´ çš„å¯¹è±¡

all in js ğŸ·ï¼š

- html in js
- css in js
- js in js

#### **JSX è§„èŒƒ ğŸ¨**

- JSX å…ƒç´ (é¡¶å±‚)åªèƒ½æœ‰ä¸€ä¸ªæ ¹å…ƒç´ (ä½¿ç”¨ Fragment å¯ä»¥åŒ…è£¹å¤šä¸ªå…ƒç´ æˆ–è€… Portals),**Portals å¯ä»¥æ¸²æŸ“å­èŠ‚ç‚¹åœ¨ä¸åŒ DOM å­æ ‘ä¸­**
- **é˜…è¯»æ€§ ,é€šå¸¸ä½¿ç”¨ () åŒ…è£¹å¤šè¡Œçš„ JSX ,å¹¶ä¸”å¯ä»¥å®ç° JSX çš„æ¢è¡Œ**
- JSX å…ƒç´ çš„å±æ€§åå¿…é¡»æ˜¯é©¼å³°å‘½åæ³•
- JSX çš„è‡ªå®šä¹‰ç»„ä»¶å¿…é¡»æ˜¯å¤§å†™å­—æ¯å¼€å¤´çš„é©¼å³°å‘½åæ³•
- JSX æ ‡ç­¾å¯ä»¥æ˜¯å•*é—­åˆæ ‡ç­¾* ,ä¹Ÿå¯ä»¥æ˜¯åŒé—­åˆæ ‡ç­¾
- JSX æ³¨é‡Šä½¿ç”¨ { /\* \*/ } ,ä¸èƒ½ä½¿ç”¨ { // } ,å¦åˆ™ä¼šè¢«å½“åšæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼
- JSX ä¸­å˜é‡çš„ä½¿ç”¨ ,ä½¿ç”¨ {} åŒ…è£¹å˜é‡
- **JSX ä¸­ class å±æ€§ä½¿ç”¨ className(ç”±äº jsx ä¸ js è€¦åˆæ€§,class æ˜¯å…³é”®å­—)**,ä½¿ç”¨ class React å¯ä»¥è¯†åˆ« ,ä½†æ˜¯åœ¨æµè§ˆå™¨ä¸­ä¼šæŠ¥é”™(Warn: Invalid DOM property `class`. Did you mean `className`?) ,å› ä¸º class æ˜¯ js ä¸­çš„å…³é”®å­— ,åœ¨ jsx ä¸­ä½¿ç”¨ class ä¼šè¢«å½“åšæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼(å®¹æ˜“é€ æˆ babel è½¬æ¢é”™è¯¯è¯¯è§£)
- JSX **ä¸æ”¯æŒç›´æ¥åœ¨ style ä¸­ä½¿ç”¨å­—ç¬¦ä¸²** ,éœ€è¦ä½¿ç”¨å¯¹è±¡çš„å˜é‡å½¢å¼(ğŸ›Ÿ)

```js
// åŠ¨æ€ class

// 1
const className = `box ${isShow ? "show" : "hide"}`;

// 2
const classNameList = ["box"];
isShow && classNameList.push("show");

<div className={className}></div>;
<div className={classNameList}></div>; // å¯ä»¥æ˜¯ä¸€ä¸ªæ•°ç»„

// 3 => ç¬¬ä¸‰æ–¹åº“ classnames ğŸ“
import classNames from "classnames";
<div className={classNames("box", { show: isShow })}></div>;
```

**JSX `<div>{å˜é‡}<div/>`ä¸­å˜é‡çš„è¯´æ˜ ğŸ¯ï¼š**

- `Number` | `String` | `Array(éå†)` ç±»å‹çš„å˜é‡ç›´æ¥æ¸²æŸ“
- `Null` | `Undefined` ï½œ `Boolean` ç±»å‹çš„å˜é‡ä¸æ¸²æŸ“(ç©º ,å¦‚æœéœ€è¦å¯ä»¥è½¬æ¢æˆå­—ç¬¦ä¸² ,toString()ã€String()ã€+''ç­‰)
- **`Object` ç±»å‹çš„å˜é‡ä¼šæŠ¥é”™(éœ€è¦è½¬æ¢æˆå­—ç¬¦ä¸² ,JSON.stringify()ç­‰), not valid as a React child**

**JSX ä¸­ {} è¯´æ˜ ğŸ¯ï¼š**
`{}` ä¸­å¯ä»¥æ”¾ç½®å¾ˆå¤šè¯­æ³• , ä¾‹å¦‚ï¼šå˜é‡ã€è¡¨è¾¾å¼ã€å‡½æ•°ã€æ•°ç»„ã€ä¸‰å…ƒè¡¨è¾¾å¼ã€é€»è¾‘è¿ç®—ç¬¦ã€æ¡ä»¶è¿ç®—ç¬¦ã€å‡½æ•°è°ƒç”¨ç­‰(**Object ä¼šæŠ¥é”™**)

**å…¶å®ƒè¯´æ˜ ğŸ¯ï¼š**

#### React å“²å­¦

ä¸ºä»€ä¹ˆ React è¦é€‰æ‹© JSX ï¼Ÿ
ğŸ¤ï¼šå› ä¸ºå®ƒæ˜¯ä¸€ç§æ›´åŠ ä¼˜é›…çš„æ–¹å¼æ¥æè¿° UI , React è®¤ä¸º UI(HTML) ä»£ç å’Œä¸šåŠ¡é€»è¾‘(JavaScript)ä»£ç æ˜¯å¾ˆéš¾åˆ†ç¦»çš„(å­˜åœ¨è€¦åˆå…³è”æ€§é«˜,å¦‚æŸäº›çŠ¶æ€æ”¹å˜æ—¶éœ€è¦æ›´æ–° UI), æ‰€ä»¥ React é€‰æ‹©å°† UI ä»£ç å’Œä¸šåŠ¡é€»è¾‘ä»£ç æ”¾åœ¨ä¸€èµ·, é€šè¿‡ JSX è¯­æ³•æ¥æè¿° UI , é€šè¿‡ JavaScript è¯­æ³•æ¥æè¿°ä¸šåŠ¡é€»è¾‘.

#### JSX çš„æœ¬è´¨ä¸åŸç†

`<div></div>` é€šè¿‡ babel è½¬åŒ– `React.createElement('div', null, null)` React.createElement() æ–¹æ³•åˆ›å»ºå¹¶è¿”å›æŒ‡å®šç±»å‹çš„æ–°çš„ React å…ƒç´ (è™šæ‹ŸèŠ‚ç‚¹)å¯¹è±¡ , è¯¥å…ƒç´ å°†è¢« React ç”¨æ¥æ„å»º DOM , é€šå¸¸ä¸ç›´æ¥ä½¿ç”¨ React.createElement() , è€Œæ˜¯é€šè¿‡ JSX æ¥ç¼–å†™ä»£ç .

`createElement()`æºç ä½äº `react/packages/react/src/ReactElement.js` ä¸­

```js
export function createElement(type, config, children) {
  // ...

  // æ–°çš„ React å…ƒç´ (è™šæ‹ŸèŠ‚ç‚¹)å¯¹è±¡
  return ReactElement(type, key, ref, self, source, ReactCurrentOwner.current, props);
}
```

> **ReactElement è°ƒç”¨è¿”å›çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ , è¯¥å¯¹è±¡åŒ…å«äº† React å…ƒç´ (èŠ‚ç‚¹)çš„æ‰€æœ‰ä¿¡æ¯ , ä¾‹å¦‚ï¼štypeã€keyã€refã€selfã€sourceã€ownerã€props** > **React åˆ©ç”¨è¿™äº›èŠ‚ç‚¹å¯¹è±¡ç»„æˆä¸€ä¸ª Javascript å¯¹è±¡æ ‘(è™šæ‹Ÿ DOM ) ,æ¥æ„å»º DOM , ä»¥åŠæ›´æ–° DOM**

[dome æµ‹è¯•](https://babeljs.io/repl)

![shadow](./image-20230205195946731.png)

> **å…¶ä¸­ /\_#**PURE**\_/ æ˜¯ React 16.13 ç‰ˆæœ¬æ–°å¢çš„è¯­æ³• , ç”¨äºæ ‡è®° JSX è½¬æ¢åçš„ä»£ç  , ä»¥ä¾¿äº React DevTools è¯†åˆ« ;å¹¶ä¸”ç”¨äºå‘Šè¯‰ æ˜¯ä¸€ä¸ªçº¯å‡½æ•° ,å¯ä»¥è¿›è¡Œ tree-shaking , ä»¥ä¾¿äºå‡å°‘æ‰“åŒ…ä½“ç§¯**

#### æ¦‚å¿µ

React ç»„ä»¶ç›¸å¯¹å…¶å®ƒç»„ä»¶æ›´åŠ çµæ´»å¤šæ ·ï¼š

- æ ¹æ®ç»„ä»¶çš„å®šä¹‰æ–¹å¼åˆ†ä¸ºï¼š**å‡½æ•°å¼å’Œç±»å¼**ç»„ä»¶ ,18.x åå‡½æ•°å¼ç»„ä»¶ä½¿ç”¨è¾ƒå¤š(Hook,**Hook å¼¥è¡¥äº†å‡½æ•°å¼è¾ƒå¤šç¼ºç‚¹**)
- æ ¹æ®ç»„ä»¶å†…éƒ¨æ˜¯å¦æœ‰çŠ¶æ€åˆ†ä¸ºï¼š**æ— çŠ¶æ€ï¼ˆStateless Componentï¼‰å’Œæœ‰çŠ¶æ€ï¼ˆStateful Componentï¼‰**ç»„ä»¶
- æ ¹ä¸åŒèŒè´£åˆ†ä¸ºï¼š**å±•ç¤ºå‹ï¼ˆPresentational Component å’Œå®¹å™¨å‹ï¼ˆContainer Component**ç»„ä»¶

> ä¸€èˆ¬æƒ…å†µä¸‹åˆ’åˆ† `class` æ˜¯æœ‰çŠ¶æ€çš„ç»„ä»¶,`å‡½æ•°`æ˜¯æ— çŠ¶æ€ç»„ä»¶
>
> å‡½æ•°å¼ç»´æŠ¤è‡ªå·±çš„çŠ¶æ€ä½¿ç”¨ï¼š`useState`(Hook)

### React 18.x çš„æ ¸å¿ƒè¯­æ³•

[å…³äº Eslint æŠ¥é”™çš„è§£å†³æ–¹æ¡ˆ `react/jsx-uses-react react/react-in-jsx-scope`](https://ja.reactjs.org/blog/2020/09/22/introducing-the-new-jsx-transform.html)

ä½¿ç”¨å‘½ä»¤è¡Œæ·»åŠ  script è„šæœ¬

```sh
npm pkg set scripts.prepare="husky install"
```

**æ’ä»¶æ¨è ğŸª‚ **

![image-20230206221725389](./image-20230206221725389.png)

`rcc`:å¿«é€Ÿç”Ÿæˆ class ç»„ä»¶

`rpc`ã€`rce`...

#### ç”Ÿå‘½å‘¨æœŸ

![](./ç”Ÿå‘½å‘¨æœŸ.png)

--- Mounting æŒ‚è½½

1ã€ç±» constructor æ„é€ å‡½æ•°åˆå§‹åŒ–

2ã€æ‰§è¡Œ render æ–¹æ³•

3ã€ç»„ä»¶è¢«æŒ‚è½½åˆ° DOM æ‰§è¡Œ componentDidMount(å®˜æ–¹å»ºè®®:åœ¨æ­¤å¤„å‘é€ç½‘ç»œè¯·æ±‚ã€è®¢é˜…äº‹ä»¶)

--- Updating æ›´æ–°(State å‘ç”Ÿä¿®æ”¹æ—¶)

4ã€é‡æ–°æ‰§è¡Œ render æ–¹æ³•

5ã€ç»„ä»¶è¢« React æ›´æ–°æŒ‚è½½åˆ° DOM æ‰§è¡Œ componentDidUpdate(prevProps, prevState,snapshot)

--- Unmounting å¸è½½

6ã€ç»„ä»¶å³å°†è¢«å¸è½½æ‰§è¡Œ componentWillUnmount æ–¹æ³•(åœ¨æ­¤å¤„å–æ¶ˆè®¢é˜…)

**ä¸å¸¸ç”¨çš„ç”Ÿå‘½å‘¨æœŸï¼š**

- getDerivedStateFromProps(nextProps, prevState)ï¼šåœ¨ç»„ä»¶æŒ‚è½½å’Œæ›´æ–°æ—¶è°ƒç”¨ï¼Œ**è¿”å›ä¸€ä¸ªå¯¹è±¡æ¥æ›´æ–° state**ï¼Œæˆ–è€…è¿”å› null æ¥ä¸æ›´æ–°ä»»ä½•å†…å®¹
- getSnapshotBeforeUpdate(prevProps, prevState)ï¼šåœ¨æœ€è¿‘ä¸€æ¬¡æ¸²æŸ“è¾“å‡ºï¼ˆæäº¤åˆ° DOM èŠ‚ç‚¹ï¼‰ä¹‹å‰è°ƒç”¨ã€‚**å®ƒä½¿å¾—ç»„ä»¶èƒ½åœ¨å‘ç”Ÿæ›´æ”¹ä¹‹å‰ä» DOM ä¸­æ•è·ä¸€äº›ä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼Œæ»šåŠ¨ä½ç½®ï¼‰ã€‚æ­¤ç”Ÿå‘½å‘¨æœŸçš„ä»»ä½•è¿”å›å€¼å°†ä½œä¸ºå‚æ•°ä¼ é€’ç»™ componentDidUpdate()ã€‚**
- shouldComponentUpdate(nextProps, nextState)ï¼š**è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œç”¨äºæŒ‡ç¤ºç»„ä»¶æ˜¯å¦åº”è¯¥æ›´æ–°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒè¿”å› trueã€‚(æ§åˆ¶æ˜¯å¦æ‰§è¡Œ render æ–¹æ³•)**

[**æ›´å¤šè¯¦ç»†ç”Ÿå‘½å‘¨æœŸ**](https://zh-hans.reactjs.org/docs/react-component.html#the-component-lifecycle)

#### ç»„ä»¶é€šè®¯(åµŒå¥—)

// ...
é€šè¿‡ propsã€stateã€contextã€refã€reduxã€mobxã€hook ç­‰æ–¹å¼,å®ç°ç»„ä»¶é—´é€šè®¯

```js
class App extends React.Component {
  // ...ä¸æ‰§è¡Œä»¥ä¸‹ä»£ç ä¹Ÿ OK,React é»˜è®¤ä¼šæ‰§è¡Œä¿å­˜ Props
  constructor(props) {
    super(props);
  }
}
```

#### å—æ§è¾“å…¥ç©ºå€¼

åœ¨[å—æ§ç»„ä»¶](https://zh-hans.reactjs.org/docs/forms.html#controlled-components)ä¸ŠæŒ‡å®š `value` çš„ prop ä¼šé˜»æ­¢ç”¨æˆ·æ›´æ”¹è¾“å…¥ã€‚å¦‚æœä½ æŒ‡å®šäº† `value`ï¼Œä½†è¾“å…¥ä»å¯ç¼–è¾‘ï¼Œåˆ™å¯èƒ½æ˜¯ä½ æ„å¤–åœ°å°† `value` è®¾ç½®ä¸º `undefined` æˆ– `null`ã€‚

ä¸‹é¢çš„ä»£ç æ¼”ç¤ºäº†è¿™ä¸€ç‚¹ã€‚ï¼ˆè¾“å…¥æœ€åˆè¢«é”å®šï¼Œä½†åœ¨çŸ­æ—¶é—´å»¶è¿Ÿåå˜ä¸ºå¯ç¼–è¾‘ã€‚ï¼‰

```js
ReactDOM.createRoot(mountNode).render(<input value="hi" />);

setTimeout(function () {
  ReactDOM.createRoot(mountNode).render(<input value={null} />);
}, 1000);
```

#### Props ç±»å‹ ğŸ·

- å¦‚æœé¡¹ç›®ä¸­é»˜è®¤ä½¿ç”¨ Flow æˆ– TypeScriptï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ Flow æˆ– TypeScript æ¥ç›´æ¥å®šä¹‰ Props ç±»å‹
- å¦‚æœé¡¹ç›®ä¸­æ²¡æœ‰ä½¿ç”¨ Flow æˆ– TypeScriptï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ prop-types åº“æ¥å®šä¹‰ Props ç±»å‹,è¿›è¡Œå‚æ•°ç±»å‹æ ¡éªŒ
  > ä» React v15.5 å¼€å§‹ï¼ŒReact.PropTypes å·²è¢«å¼ƒ(è¿ç§»åˆ° prop-types)ã€‚è¯·ä½¿ç”¨ prop-types åº“ä»£æ›¿ã€‚

##### Props ç‰¹åˆ«ä¼ é€’ ğŸ¥½

```js
const info = {
  name: "aoe",
  age: 22,
};
<App {...info} />;
```

```js
import PropTypes from "prop-types";

class App extends React.Component {}


// å®šä¹‰ Props ç±»å‹
App.propTypes = {
  city: PropTypes.string.isRequired,
  name: PropTypes.node, // æ˜¯å¦æ˜¯èŠ‚ç‚¹
  age: PropTypes.instanceOf(Number), // æ˜¯å¦æ˜¯ Number ç±»å‹
  sex:PropTypes.oneOf(['ç”·','å¥³']), // æ˜¯å¦æ˜¯æŒ‡å®šçš„å€¼
  hobby:PropTypes.arrayOf(PropTypes.string), // æ˜¯å¦æ˜¯æ•°ç»„
  info:PropTypes.shape({
    height:PropTypes.number,
    weight:PropTypes.func,
    element:PropTypes.element, // React å…ƒç´ 
  }), // æ˜¯å¦æ˜¯å¯¹è±¡
  address:PropTypes.exact({
    city:PropTypes.string,
    street:PropTypes.string,
  }), // å…·æœ‰é¢å¤– key è­¦å‘Šçš„å¯¹è±¡
  options:PropTypes.oneOfType([PropTypes.string,PropTypes.number]),// æ˜¯å¦æ˜¯æŒ‡å®šçš„ä»»æ„ç±»å‹
  value:PropTypes.string.isRequired, // æ˜¯å¦æ˜¯å¿…ä¼ å‚æ•°
  function:PropTypes.any ,// æ˜¯å¦æ˜¯ä»»æ„ç±»å‹
  // è‡ªå®šä¹‰æ ¡éªŒ
  custom:function(props,propName,componentName){
    if(!/matchme/.test(props[propName])){
      return new Error(
        'Invalid prop `' + propName + '` supplied to' +
        ' `' + componentName + '`. Validation failed.'
      );
    }
  }
  // ...
};

// é»˜è®¤ Props
App.defaultProps = {
  name: "å¼ ä¸‰",
}

// ä» ES 2022 å¼€å§‹ï¼Œå¯ä»¥ä½¿ç”¨ static å…³é”®å­—å®šä¹‰é™æ€å±æ€§(é»˜è®¤å€¼)
class App extends React.Component {
  static defaultProps = {
    // ...
  }
  // defaultProps ç”¨äºç¡®ä¿ this.props.name åœ¨çˆ¶ç»„ä»¶ä¸­æ²¡æœ‰è¢«æŒ‡å®šæ—¶ï¼Œæœ‰ä¸€ä¸ªåˆå§‹å€¼ã€‚
  // PropTypes ç±»å‹æ£€æŸ¥å‘ç”Ÿåœ¨ defaultProps èµ‹å€¼ä¹‹åï¼Œæ‰€ä»¥ç±»å‹æ£€æŸ¥ä¹Ÿä¼šåº”ç”¨äº defaultPropsã€‚
}
default export App;
```

[`æ›´å¤šç±»å‹æ ¡éªŒè¯´æ˜`](https://zh-hans.reactjs.org/docs/typechecking-with-proptypes.html)

#### React å­ä¼ çˆ¶ç»„ä»¶çš„æ–¹æ³• 

> React åŒæ ·ä¹Ÿæ˜¯é€šè¿‡ Props æ¥å®ç°å­ç»„ä»¶å‘çˆ¶ç»„ä»¶ä¼ é€’æ•°æ®çš„,ä¸ Vue ä¸åŒçš„æ˜¯ React æ˜¯é€šè¿‡çˆ¶ç»„ä»¶ä¼ é€’å­ç»„ä»¶ä¸€ä¸ªå›è°ƒå‡½æ•°ç»™å­ç»„ä»¶,å­ç»„ä»¶é€šè¿‡è°ƒç”¨è¿™ä¸ªå›è°ƒå‡½æ•°æ¥å‘çˆ¶ç»„ä»¶ä¼ é€’æ•°æ®

#### React æ’æ§½ 

> React æ²¡æœ‰æ’æ§½(Slot)çš„æ¦‚å¿µ,ä½†æ˜¯ç»„ä»¶ children å±æ€§å¯ä»¥å®ç°ç±»ä¼¼çš„åŠŸèƒ½æˆ–è€…å¯ä»¥é€šè¿‡ Props æ¥çµæ´»å®ç°æ’æ§½çš„åŠŸèƒ½

**children å±æ€§ **

```js
// çˆ¶ç»„ä»¶
<App>
  <div>å­ç»„ä»¶</div>
</App>;

// å­ç»„ä»¶
class App extends React.Component {
  render() {
    // å¤šä¸ªå­ç»„ä»¶ children æ˜¯ä¸€ä¸ªæ•°ç»„,å•ä¸ªå­ç»„ä»¶ children æ˜¯ä¸€ä¸ªå¯¹è±¡
    return <div>{this.props.children}</div>;
  }
}

App.propTypes = {
  children: PropTypes.node,
  // or
  children: PropTypes.array, // å¤šä¸ªå­ç»„ä»¶
};
```

> Children å¼Šç«¯: æ— æ³•åŒºåˆ†å­ç»„ä»¶çš„ä½ç½®,æ— æ³•çµæ´»æ§åˆ¶å­ç»„ä»¶çš„ä½ç½®,æ— æ³•æ§åˆ¶å­ç»„ä»¶çš„æ•°é‡,æ— æ³•æ§åˆ¶å­ç»„ä»¶çš„ç±»å‹

**Props å±æ€§**

```js
// çˆ¶ç»„ä»¶
<App
  slots={{
    "i-mIronMan": <div>æˆ‘æ˜¯é’¢é“ä¾ </div>,
    "i-mThor": <div>æˆ‘æ˜¯é›·ç¥</div>,
  }}
></App>;

// å­ç»„ä»¶
class App extends React.Component {
  render() {
    // å¤šä¸ªå­ç»„ä»¶ children æ˜¯ä¸€ä¸ªæ•°ç»„,å•ä¸ªå­ç»„ä»¶ children æ˜¯ä¸€ä¸ªå¯¹è±¡
    return <div>{this.props.slots["i-mIronMan"]}</div>;
  }
}
```

> **ä½œç”¨åŸŸæ’æ§½æ—¶,å¯ä»¥é€šè¿‡å‡½æ•°ä¼ å‚æ¥å®ç°**

#### Context ä¸Šä¸‹æ–‡ 

> Context æä¾›äº†ä¸€ç§åœ¨ç»„ä»¶ä¹‹é—´å…±äº«æ­¤ç±»å€¼çš„æ–¹å¼ï¼Œè€Œä¸å¿…æ˜¾å¼åœ°é€šè¿‡ç»„ä»¶æ ‘çš„é€å±‚ä¼ é€’ props
> Context é€‚ç”¨äºä¸€äº›æ•°æ®è¢«å¾ˆå¤šç»„ä»¶éœ€è¦è®¿é—®çš„æƒ…å†µã€‚ä¾‹å¦‚ï¼Œå½“å‰è®¤è¯çš„ç”¨æˆ·ã€ä¸»é¢˜æˆ–é¦–é€‰è¯­è¨€ã€‚(éçˆ¶å­ç»„ä»¶ä¼ å€¼)

```js
// ä½¿ç”¨ Context
// 1. Provider
// 2. Consumer
// 3. useContext
// åˆ›å»º Context(éœ€è¦åˆ›å»º,å¯ä»¥ä¼ å…¥ä¸€ä¸ªé»˜è®¤å€¼,å³ä½¿æ˜¯åœ¨åŒ…è£¹å±‚å¤–é¢ä¹Ÿå¯ä»¥å…±äº«é»˜è®¤å€¼)
const AppContext = React.createContext(defaultValue);

// value is Object
// ä½¿ç”¨ Provider åŒ…è£¹ ,å…±äº«çš„ç»„ä»¶å¿…é¡»æ˜¯åä»£å…ƒç´  ,value ä¸ºå…±äº«çš„æ•°æ®
// Provider å¯ä»¥åµŒå¥—ä½¿ç”¨,å†…å±‚çš„ Provider ä¼šè¦†ç›–å¤–å±‚çš„ Provider å€¼
// Provider å‘ç”Ÿå˜åŒ–æ—¶,å†…éƒ¨æ‰€æœ‰æ¶ˆè´¹è€…éƒ½ä¼šé‡æ–°æ¸²æŸ“,ä¼šå¯¼è‡´ Consumer ä¸‹æ‰€æœ‰çš„ç»„ä»¶é‡æ–°æ¸²æŸ“
<AppContext.Provider value={value}>
  <App />
</AppContext.Provider>;
// ğŸª‚ğŸª‚ğŸª‚ è·å– value çš„æ–¹å¼ App ç»„ä»¶ä¸­:
class App extends React.Component {
  // this.context è·å– value
}
// å£°æ˜ contextType ä¸º AppContext ,å¯ä»¥é€šè¿‡ this.context è·å– value(å¦åˆ™æ— æ³•é€šè¿‡ this.context è·å– value,React ä¸çŸ¥é“ä½ æƒ³è¦è·å–å“ªä¸ª context)
// å¯ä»¥åœ¨ä»»ä½•ç”Ÿå‘½å‘¨æœŸä¸­è®¿é—®åˆ° this.context,åŒ…æ‹¬ render å‡½æ•°ä¸­
App.contextType = AppContext;

// åªèƒ½è®¾ç½®ä¸€ä¸ª contextType,å¯ä»¥ç»“åˆ Consumer ä½¿ç”¨å¤šä¸ª context
class App extends React.Component {
  static contextType = AppContext;
  render() {
    return (
      <BppContext.Consumer>
        // å…¶å®ƒçš„ value
        {(value) => {
          return <div>{value}</div>;
        }}
      </BppContext.Consumer>
    );
  }
}

// ä½¿ç”¨ Consumer
// Consumer å‡½æ•°ä½¿ç”¨,åœ¨ value ä¸­è·å–å…±äº«çš„æ•°æ®
function App() {
  return <AppContext.Consumer>{(value) => <div>{value}</div>}</AppContext.Consumer>;
}

// ä½¿ç”¨ useContext
// useContext
// const value = useContext(AppContext);

// ä½¿ç”¨ useContext çš„ Hook
function App() {
  const value = useContext(AppContext);
  return <div>{value}</div>;
}
```

##### äº‹ä»¶æ€»çº¿ EventBus

> äº‹ä»¶æ€»çº¿é€‚ç”¨äº Reactã€Vueã€Angularã€å°ç¨‹åºç­‰æ¡†æ¶
> äº‹ä»¶æ€»çº¿æ˜¯ä¸€ä¸ªå…¨å±€çš„äº‹ä»¶ä¸­å¿ƒ,å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è§¦å‘äº‹ä»¶,ä¹Ÿå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ç›‘å¬äº‹ä»¶

**åº“æ¨èï¼š**

- mitt
- mitt-ee
- eventemitter3

```js
// mitt
// 1. åˆ›å»ºäº‹ä»¶æ€»çº¿
const emitter = mitt();

// 2. è§¦å‘äº‹ä»¶
emitter.emit("eventName", data);

// 3. ç›‘å¬äº‹ä»¶ - ğŸ“ å»ºè®®åœ¨ componentDidMount ä¸­ç›‘å¬äº‹ä»¶,åœ¨ componentWillUnmount ä¸­ç§»é™¤äº‹ä»¶
emitter.on("eventName", (data) => {
  console.log(data);
});

// 4. ç§»é™¤äº‹ä»¶
emitter.off("eventName", (data) => {
  console.log(data);
});

// 5. ç§»é™¤æ‰€æœ‰äº‹ä»¶
emitter.all.clear();
```

#### setState and createElement - æµ…æ 

> **ğŸ² setState åœ¨æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶,ä¼šè§¦å‘ç»„ä»¶çš„ render é‡æ–°æ¸²æŸ“,ä½†æ˜¯å¹¶ä¸ä¼šç«‹å³è§¦å‘ render,è€Œæ˜¯ä¼šå°† setState çš„æ•°æ®æ”¾å…¥é˜Ÿåˆ—ä¸­,ç­‰å¾…åˆé€‚çš„æ—¶æœºè§¦å‘ render(å¼‚æ­¥çš„)** > **ğŸ›µ Vue ä¹ŸåŒç†,åªä¸è¿‡å¼€å‘è€…æ˜¯çœ‹ä¸åˆ° render çš„è¿‡ç¨‹çš„,å› ä¸º Vue ä¼šå°†æ¨¡æ¿ç¼–è¯‘æˆ render å‡½æ•°,åœ¨æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶,ä¼šè§¦å‘ render å‡½æ•°é‡æ–°æ¸²æŸ“** > **ğŸš React æ²¡æœ‰åƒ Vue ä¸€æ ·å¯¹æ•°æ®è¿›è¡ŒåŠ«æŒå¹¶åœ¨ setter ä¸­è§¦å‘ render,è€Œæ˜¯é€šè¿‡ setState æ¥è§¦å‘ render,æ‰€ä»¥ React éœ€è¦æ‰‹åŠ¨è°ƒç”¨ setState æ¥è§¦å‘ render è¿›è¡Œæ›´æ–°**

---

**`???`** å¦‚æœåœ¨ setState ä¸­æ›´æ–°çš„å€¼å’Œä¹‹å‰çš„å€¼ä¸€æ ·,ä¼šå‘ç”Ÿä»€ä¹ˆ?
**React è¿˜æ˜¯ä¼šè§¦å‘ render,ä½†æ˜¯ä¸ä¼šæ›´æ–° DOM,å› ä¸º React ä¼šå¯¹æ¯”æ–°æ—§æ•°æ®,å¦‚æœæ–°æ—§æ•°æ®ä¸€æ ·,å°±ä¸ä¼šæ›´æ–° DOM**,åŒæ ·å¯ä»¥ä½¿ç”¨ shouldComponentUpdate æ¥ä¼˜åŒ–

---

> #### PureComponentã€memo
>
> **ğŸ›´ ç”±äºæ¯æ¬¡éƒ½éœ€è¦é€šè¿‡ shouldComponentUpdate æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦æ›´æ–°,æ‰€ä»¥ React 16.3 ç‰ˆæœ¬ä¹‹åæä¾›äº† PureComponent æ¥è§£å†³è¿™ä¸ªé—®é¢˜,å®ƒä¼šè‡ªåŠ¨åˆ¤æ–­æ˜¯å¦éœ€è¦æ›´æ–°,å¦‚æœä¸éœ€è¦æ›´æ–°,å°±ä¸ä¼šè§¦å‘ render > ä½†æ˜¯ PureComponent åªèƒ½å¯¹ props å’Œ state è¿›è¡Œæµ…æ¯”è¾ƒ,å¦‚æœ props å’Œ state ä¸­æœ‰å¤æ‚æ•°æ®ç±»å‹,å°±ä¼šå‡ºç°é—®é¢˜, memo ç”¨äºå‡½æ•°ç»„ä»¶çš„åˆ¤æ–­**

> ---

ğŸ¤¨ åœ¨ class ç»„ä»¶ä¸­å¹¶æ²¡æœ‰çœ‹åˆ° setState çš„å®ç°,ä½†æ˜¯åœ¨ç»„ä»¶ä¸­å´å¯ä»¥ä½¿ç”¨,è¿™æ˜¯ä¸ºä»€ä¹ˆ?
1ã€æ‹‰å– React æºç 

```sh
git clone https://github.com/facebook/react.git
```

2ã€åœ¨ `packages/react/index.js` ä¸­å¯ä»¥æ‰¾åˆ°æ‰€æœ‰çš„å¯¼å‡º
![image-20230206221725389](/Volumes/aoe/web-design/pers-code/web-react-simple/æˆªå± 2023-02-08 20.23.12.png)

3ã€æŸ¥çœ‹ React æºç ,æœç´¢ `Component.prototype.setState`

```js
/**
 * Sets a subset of the state. Always use this to mutate
 * state. You should treat `this.state` as immutable.
 *
 * There is no guarantee that `this.state` will be immediately updated, so
 * accessing `this.state` after calling this method may return the old value.
 *
 * There is no guarantee that calls to `setState` will run synchronously,
 * as they may eventually be batched together.  You can provide an optional
 * callback that will be executed when the call to setState is actually
 * completed.
 *
 * When a function is provided to setState, it will be called at some point in
 * the future (not synchronously). It will be called with the up to date
 * component arguments (state, props, context). These values can be different
 * from this.* because your function may be called after receiveProps but before
 * shouldComponentUpdate, and this new state, props, and context will not yet be
 * assigned to this.
 *
 * @param {object|function} partialState Next partial state or function to
 *        produce next partial state to be merged with current state.
 * @param {?function} callback Called after state is updated.
 * @final
 * @protected
 */
Component.prototype.setState = function (partialState, callback) {
  // åˆ¤æ–­ partialState æ˜¯å¦æ˜¯å¯¹è±¡æˆ–è€…å‡½æ•°,å¦‚æœä¸æ˜¯,å°±æŠ›å‡ºå¼‚å¸¸
  if (typeof partialState !== "object" && typeof partialState !== "function" && partialState != null) {
    throw new Error("setState(...): takes an object of state variables to update or a " + "function which returns an object of state variables.");
  }

  this.updater.enqueueSetState(this, partialState, callback, "setState");
};
```

4ã€æŸ¥çœ‹ createElment æºç ,`packages/react/src/ReactElement.js`

> å‘ç°å®é™… `createElement('div',{},å­å…ƒç´ ,å­å…ƒç´ ,å­å…ƒç´ )` ä¸­ä¼ å…¥çš„å‚æ•°æ–¹å¼ä¸æ˜¯æŒ‰ç…§ React createElement ä¸­ç¬¬ä¸‰ä¸ªå‚æ•° children æ–¹å¼ä¼ å…¥çš„,è€Œæ˜¯æŒ‰ç…§ `arguments`(å‰©ä½™å‚æ•°) çš„æ–¹å¼ä¼ å…¥çš„,æ‰€ä»¥åœ¨ `ReactElement.js` ä¸­å¯ä»¥çœ‹åˆ° `createElement` çš„å®ç°å’Œå¯¹ `arguments` çš„å¤„ç†

```js
// è·å–å‰©ä½™å‚æ•°çš„é•¿åº¦
const childrenLength = arguments.length - 2;

// ç­‰äº 1 è¯´æ˜åªæœ‰ä¸€ä¸ªå­å…ƒç´ ,è¿™å°±æ˜¯ä¸Šé¢æåˆ°çš„ä¸€ä¸ªå…ƒç´ å°±ç›´æ¥è¿”å›
if (childrenLength === 1) {
  props.children = children;

  // å¤§äº 1 è¯´æ˜æœ‰å¤šä¸ªå­å…ƒç´ ,è¿™å°±æ˜¯ä¸Šé¢æåˆ°çš„å¤šä¸ªå…ƒç´ å°±æ”¾åˆ°æ•°ç»„ä¸­
} else if (childrenLength > 1) {
  const childArray = Array(childrenLength);
  for (let i = 0; i < childrenLength; i++) {
    childArray[i] = arguments[i + 2];
  }

  // è¿™é‡Œæ˜¯å¼€å‘ç¯å¢ƒä¸‹,å¦‚æœæ˜¯å¼€å‘ç¯å¢ƒ,å°±å†»ç»“æ•°ç»„,é˜²æ­¢æ•°ç»„è¢«ä¿®æ”¹(æ€§èƒ½è€ƒè™‘)
  if (__DEV__) {
    if (Object.freeze) {
      Object.freeze(childArray);
    }
  }
  props.children = childArray;
}
```

<img src="./%E6%88%AA%E5%B1%8F2023-02-08%2020.33.00.png" style="zoom:150%;" />

##### setState å¼‚æ­¥è¯¦ç»†è§£æ

setState å›è°ƒå‡½æ•°

> setState å¯ä»¥åœ¨å›è°ƒå‡½æ•°ä¸­ç¼–å†™**æ–°çš„ State é€»è¾‘**
> å°† state å’Œ props ä½œä¸ºå‚æ•°ä¼ å…¥å›è°ƒå‡½æ•°ä¸­ï¼Œå¯ä»¥è·å–åˆ°æ›´æ–°å‰çš„ state å’Œ propsã€‚

```js
setState({}, (state, props) => {
  console.log(state, props);
});
```

---

setState çš„è°ƒç”¨ä¸ä¼šç«‹å³å°†ä¼ å…¥çš„å¯¹è±¡åˆå¹¶è§¦å‘ç»„ä»¶çš„æ›´æ–°é‡æ–°æ¸²æŸ“ç»„ä»¶ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯å¼‚æ­¥çš„(**18.x åé»˜è®¤å¼‚æ­¥**)ï¼Œä¹Ÿå°±æ˜¯è¯´å¤šæ¬¡è°ƒç”¨ setState ä¼šè¢«åˆå¹¶æˆä¸€æ¬¡æ›´æ–°(åŠ å…¥é˜Ÿåˆ—)ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼š

- å¯ä»¥æé«˜æ€§èƒ½ï¼Œé¿å…ä¸å¿…è¦çš„é¢‘ç¹æ¸²æŸ“,å¼•èµ·å›æµé‡ç»˜
- **å¦‚æœåŒæ­¥æ›´æ–° state(å±…äºå¤šä¸ª setState æ‰¹é‡æ›´æ–°é—®é¢˜å±•å¼€),ä½†æ˜¯è¿˜æ²¡ æ‰§è¡Œ render æ›´æ–°è¯•å›¾,é‚£ä¹ˆ state å’Œ props å°±ä¸æ˜¯æœ€æ–°çš„(ä¸èƒ½åŒæ­¥),è¿™æ ·å°±ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜(ä¿è¯ state æ²¡æœ‰è¢«æ›´æ–°çš„æ—¶å€™, å­ç»„ä»¶ prop... ä¿æŒä¸€è‡´)**

**ç”±äºæ˜¯å¼‚æ­¥çš„æ— æ³•çš„çŸ¥ä½•æ—¶æ›´æ–°å®Œæˆ,ä½•æ—¶ä¹¦å†™å®Œæˆåçš„é€»è¾‘ä»£ç ,æ‰€ä»¥ setState æä¾›äº†ä¸€ä¸ªå›è°ƒå‡½æ•°(ç¬¬äºŒä¸ªå‚æ•°),åœ¨æ›´æ–°å®Œæˆåæ‰§è¡Œ**

[æ›´å¤šè¯¦ç»†ä»‹ç»](https://github.com/reactwg/react-18/discussions/21)

```js
// å¯¹è±¡åˆå¹¶å®Œæˆå,æ‰§è¡Œå›è°ƒå‡½æ•°
this.setState({}, () => {
  console.log(this.state.count);
});

// ä½¿ç”¨å‡½æ•°æ–¹å¼å‡†ç¡®è·å–æœ€æ–°çš„ state
this.setState((state, props) => {
  // æ€è€ƒè¿™é‡Œçš„è¡Œå‚ state æ˜¯ä¸Šä¸€æ¬¡æ›´æ–°åçš„ state,é‚£ä¹ˆåœ¨è¿™é‡Œ(å‡½æ•°æ–¹å¼)ä½¿ç”¨ this.state æ˜¯ä¸æ˜¯å°±æ˜¯ä¸Šä¸€æ¬¡æ›´æ–°åçš„ stateã€ğŸ¢ å¾ˆé—æ†¾ä¸æ˜¯,ä¾ç„¶æ˜¯é¦–æ¬¡æ›´æ–°å‰çš„ stateã€‘

  return {
    count: state.count + 1,
  };
});
```

##### flushSync 18.x ååŒæ­¥æ‰§è¡Œ setState

18.x å‰çš„ç‰ˆæœ¬,setState æ˜¯åŒæ­¥çš„

```js
import { flushSync } from "react-dom";

flushSync(() => {
  this.setState({ count: 1 });
});
console.log(this.state.count); // 1
```

#### SCU æ€§èƒ½ä¼˜åŒ–

React æ›´æ–°æœºåˆ¶:

`JSX` -> `React.createElement` -> `è™šæ‹ŸèŠ‚ç‚¹` -> `è™šæ‹ŸDOM` -> `çœŸå®DOM`

æ›´æ–°æµç¨‹:

`props or state æ”¹å˜` -> `renderé‡æ–°æ‰§è¡Œ` -> `äº§ç”Ÿæ–°çš„è™šæ‹ŸDOMæ ‘` -> `æ–°æ—§è™šæ‹ŸDOMæ ‘è¿›è¡Œ diff` -> `è®¡ç®—å·®å¼‚è¿›è¡Œæ›´æ–°` -> `æ›´æ–°åˆ°çœŸå®DOM`

å¦‚æœæ¯æ¬¡ DOM å¯¹æ¯”ä½¿ç”¨äº¤å‰å¯¹æ¯”æ–¹å¼, å°†äº§ç”Ÿè¾ƒå¤§çš„å¯¹æ¯”æ¬¡æ•°(O(n çš„ 3 æ¬¡æ–¹))éå¸¸å¤§çš„æ€§èƒ½å¼€é”€[n ä¸ºæ ‘çš„èŠ‚ç‚¹æ•°]

äºæ˜¯ React å¯¹æ­¤å¯¹æ¯”æ–¹æ³•è¿›è¡Œä¼˜åŒ–, ä¼˜åŒ–ä¸º O(n):

- åŒçº§èŠ‚ç‚¹æ‰è¿›è¡Œæ¯”è¾ƒ, ä¸ä¼šè·¨çº§è¿›è¡Œæ¯”è¾ƒ(çˆ¶ä¸ä¼šåˆ°å­å±‚æ¯”è¾ƒ)
- ä¸åŒç±»å‹çš„èŠ‚ç‚¹äº§ç”Ÿä¸åŒçš„æ ‘ç»“æ„(çˆ¶èŠ‚ç‚¹ä¸åŒæ•´æ£µæ ‘é‡æ–°ç”Ÿæˆ,ä¸€èˆ¬é¡¶å±‚èŠ‚ç‚¹è¾ƒå°‘æ”¹å˜,åº•å±‚èŠ‚ç‚¹å˜åŒ–è¾ƒå¤š,æ‰€ä»¥é‡æ–°æ¸²æŸ“ä¸åŒç±»å‹çš„ä¸ä¼šäº§ç”Ÿè¾ƒå¤§çš„æ€§èƒ½å¼€é”€)
- å¼€å‘æ—¶,ä½¿ç”¨ key æ¥æŒ‡å®šå“ªäº›èŠ‚ç‚¹åœ¨ä¸åŒçš„æ¸²æŸ“ä¸‹ä¿æŒç¨³å®š(åŒå±‚æ¯”è¾ƒæ—¶å‘ç°ç±»å‹ä¸åŒ,å¯ä»¥é€šè¿‡æŸ¥æ‰¾ key èŠ‚ç‚¹å°½é‡å¤ç”¨ä¸éœ€è¦é‡æ–°æ›´æ–°)

> ##### ä¸åŒç±»å‹çš„èŠ‚ç‚¹äº§ç”Ÿä¸åŒçš„æ ‘ç»“æ„:
>
> å½“çˆ¶ç»„ä»¶æ•°æ®å˜åŒ–æ—¶,åµŒå¥—çš„æ‰€æœ‰å­ç»„ä»¶éƒ½ä¼šè°ƒç”¨ render é‡æ–°ç”Ÿæˆ(äº§ç”Ÿè™šæ‹Ÿå¼€é”€,å¦‚æœå­ç»„ä»¶ç±»å‹ä¸å˜æ•°æ®ä¸å˜ä¸ä¼šé‡æ–°æ›´æ–°åˆ°çœŸå® DOM ä¸Š)
>
> è§£å†³åŠæ³•ï¼š
>
> **ä¸€ï¼šä½¿ç”¨ shouldComponentUpdate(SCU) é˜»æ­¢è°ƒç”¨ render**
>
> ```js
> // æœ€æ–°çš„propsã€state(è¢«ä¿®æ”¹ä¹‹åçš„)
> shouldComponentUpdate(nextProps,nextState){
>   // this.state æ˜¯æ—§çš„,éœ€è¦é€šè¿‡å‚æ•°è·å–æœ€æ–°çš„
>
>   // ...å¯¹æ–°æ—§æ•°æ®è¿›è¡Œåˆ¤æ–­æ˜¯å¦éœ€è¦æ›´æ–°
>   this.state.xxx === nextState.xxx
> }
> ```
>
> **äºŒï¼šReact å†…ç½®äº†æ‹¥æœ‰ç¬¬ä¸€ç§æ–¹æ³•çš„çˆ¶æ„é€ å‡½æ•°ç±»ç»„ä»¶ã€PureComponentã€memoã€‘**
>
> **ğŸ›´ ç”±äºæ¯æ¬¡éƒ½éœ€è¦é€šè¿‡ shouldComponentUpdate æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦æ›´æ–°,æ‰€ä»¥ React 16.3 ç‰ˆæœ¬ä¹‹åæä¾›äº† PureComponent æ¥è§£å†³è¿™ä¸ªé—®é¢˜,å®ƒä¼šè‡ªåŠ¨åˆ¤æ–­æ˜¯å¦éœ€è¦æ›´æ–°,å¦‚æœä¸éœ€è¦æ›´æ–°,å°±ä¸ä¼šè§¦å‘ render, ä½†æ˜¯ PureComponent åªèƒ½å¯¹ props å’Œ state è¿›è¡Œæµ…æ¯”è¾ƒ,å¦‚æœ props å’Œ state ä¸­æœ‰å¤æ‚æ•°æ®ç±»å‹,å°±ä¼šå‡ºç°é—®é¢˜**
>
> **ä¸‰ï¼šå‡½æ•°ç»„ä»¶çš„æ€§èƒ½ä¼˜åŒ– memo**
>
> ```js
> // é€šè¿‡ memo åŒ…è£¹å‡½æ•°ç»„ä»¶
> import { memo } from "react";
> export const App = memo(function App() {});
> ```

#### ä¸å¯å˜çš„åŠ›é‡

> ä¸è¦è¯•å›¾ç›´æ¥æ”¹å˜ state çš„æ•°æ®(pushã€unshift...), å¦‚æœéœ€è¦æ”¹å˜è¯·ç›´æ¥ä¿®æ”¹è¦†ç›–å˜é‡çš„æŒ‡é’ˆ(ä¿®æ”¹å¯¹è±¡çš„å¼•ç”¨å€¼)
>
> ```js
> this.state = {
> a: { xxx: "" },
> b: [1, 2, 3, 4, 5],
> };
> 
> // é‡æ–°æµ…å±‚æ‹·è´ä¸€ä»½å¹¶ä¸”é‡æ–°æŒ‡å‘åœ°å€å€¼, åªå¯¹æµ…å±‚æ•°æ®è¿›è¡Œç¬”è®°
> const a = { ...this.state.a }; // !=this.state.a
> a["yyy"] = "";
> this.setState({ a });
> // åŸç†
> shouldComponentUpdate(nextProps,nextState){
>   shallowEqual(nextProps,this.props) // æµ…çš„æ¯”è¾ƒ
>   shallowEqual(nextState,this.state)
> }
> 
> // åœ¨ PureComponent ä¸­æ— æ³•å¼•èµ·ç»„ä»¶é‡æ–°æ¸²æŸ“
> this.state.b.push(6)
> this.setState({b:this.state.b})
> 
> // ä¸»è¦åœ°å€å€¼åˆ¤æ–­
> ```
>
> ###### PureComponent ğŸ‡
>
> ```js
> /**
>  * ä¸ºSCUæä¾›é»˜è®¤æµ…ç›¸ç­‰æ£€æŸ¥çš„ä¾¿åˆ©ç»„ä»¶ã€‚
>  */
> function PureComponent(props, context, updater) {
>   this.props = props;
>   this.context = context;
>   // å¦‚æœä¸€ä¸ªç»„ä»¶æœ‰å­—ç¬¦ä¸²å¼•ç”¨ï¼Œæˆ‘ä»¬ç¨åå°†åˆ†é…ä¸€ä¸ªä¸åŒçš„å¯¹è±¡ã€‚
>   this.refs = emptyObject;
>   this.updater = updater || ReactNoopUpdateQueue;
> }
> 
> 
> const pureComponentPrototype = (PureComponent.prototype = new ComponentDummy());
> pureComponentPrototype.constructor = PureComponent;
> // é¿å…ä¸ºè¿™äº›æ–¹æ³•è¿›è¡Œé¢å¤–çš„åŸå‹è·³è½¬ã€‚
> assign(pureComponentPrototype, Component.prototype);
> pureComponentPrototype.isPureReactComponent = true; // ç»™åŸå‹æ·»åŠ  isPureReactComponent å±æ€§, ç”¨äºæ¸²æŸ“åˆ¤æ–­æ˜¯å¦éœ€è¦æ¯”è¾ƒæ›´æ–°
> 
> // æ£€æŸ¥ç»„ä»¶æ˜¯å¦æ›´æ–°, è¿”å›å¸ƒå°”å€¼
> function checkShouldComponentUpdate(
>   workInProgress: Fiber,
>   ctor: any,
>   oldProps: any,
>   newProps: any,
>   oldState: any,
>   newState: any,
>   nextContext: any,
> ) {
>   const instance = workInProgress.stateNode;
>   if (typeof instance.shouldComponentUpdate === 'function') {
>     // è·å–ç»„ä»¶ä¸­çš„ shouldComponentUpdate æ–¹æ³•è¿›è¡Œè°ƒç”¨(ç”±å¼€å‘è€…æä¾›çš„)  ---  shouldComponentUpdate(newProps,newState,nextContext)
>     let shouldUpdate = instance.shouldComponentUpdate(
>       newProps,
>       newState,
>       nextContext,
>     );
>     if (__DEV__) {
>       if (
>         debugRenderPhaseSideEffectsForStrictMode &&
>         workInProgress.mode & StrictLegacyMode
>       ) {
>         setIsStrictModeForDevtools(true);
>         try {
>           // é¢å¤–è°ƒç”¨è¯¥å‡½æ•°ä»¥å¸®åŠ©æ£€æµ‹å‰¯ä½œç”¨ã€‚
>           shouldUpdate = instance.shouldComponentUpdate(
>             newProps,
>             newState,
>             nextContext,
>           );
>         } finally {
>           setIsStrictModeForDevtools(false);
>         }
>       }
>       if (shouldUpdate === undefined) {
>         console.error(
>           '%s.shouldComponentUpdate(): Returned undefined instead of a ' +
>             'boolean value. Make sure to return true or false.',
>           getComponentNameFromType(ctor) || 'Component',
>         );
>       }
>     }
> 
>     return shouldUpdate;
>   }
>     
> 
>   // å¦‚æœæ˜¯ä¸€ä¸ªçº¯å‡½æ•°æƒ…å†µä¸‹, é€šè¿‡åŸå‹ isPureReactComponent è°ƒç”¨ shallowEqual è¿›è¡Œæµ…å±‚æ¯”è¾ƒ
>   if (ctor.prototype && ctor.prototype.isPureReactComponent) {
>     return (
>       !shallowEqual(oldProps, newProps) || !shallowEqual(oldState, newState)
>     );
>   }
> 
>   return true;
> }
> ```
>
> ###### shallowEqual ğŸ¥¦
>
> ```js
> /**
>  * é€šè¿‡éå†å¯¹è±¡ä¸Šçš„é”®å¹¶è¿”å›falseæ¥æ‰§è¡Œç›¸ç­‰æ€§
>  * å½“ä»»æ„é”®çš„å‚æ•°å€¼ä¸ä¸¥æ ¼ç›¸ç­‰æ—¶ã€‚
>  * å½“æ‰€æœ‰é”®çš„å€¼ä¸¥æ ¼ç›¸ç­‰æ—¶è¿”å›trueã€‚
>  */
> function shallowEqual(objA: mixed, objB: mixed): boolean {
>   // å¯¹è±¡æµ…å±‚æ¯”è¾ƒ state çš„åœ°å€å€¼ç›¸åŒè¿”å› true ä¸æ›´æ–°
>   if (is(objA, objB)) {
>     return true;
>   }
> 
>   if (
>     typeof objA !== 'object' ||
>     objA === null ||
>     typeof objB !== 'object' ||
>     objB === null
>   ) {
>     return false;
>   }
> 
>   const keysA = Object.keys(objA);
>   const keysB = Object.keys(objB);
> 
>   // key length ï¼== è¿”å› false æ›´æ–°
>   if (keysA.length !== keysB.length) {
>     return false;
>   }
> 
>   // Test for A's keys different from B.
>   // å¾ªç¯æ¯”è¾ƒ state çš„ key æ˜¯å¦ç›¸ç­‰ 
>   for (let i = 0; i < keysA.length; i++) {
>     const currentKey = keysA[i];
>     if (
>       !hasOwnProperty.call(objB, currentKey) ||
>       !is(objA[currentKey], objB[currentKey])
>     ) {
>       return false;
>     }
>   }
> 
>   // æ²¡æœ‰å†æ·±å±‚çš„æ¯”è¾ƒäº†
>   return true;
> }
> 
> ```



#### Ref è·å– DOM



```js
// æ–¹å¼ä¸€  ---  ä¸æ¨è,å·²åºŸå¼ƒ
<div ref='e'><div/>
this.ref.e
  
// æ–¹å¼äºŒ --- æå‰åˆ›å»º ref
import {createRef} from 'react'
this.e = createRef()
<div ref={this.e}><div/>
  
// æ–¹å¼äºŒ --- å›è°ƒæ–¹å¼
this.e = null
<div ref={ el => this.e = el }><div/>
  
// --- çˆ¶å­åµŒå¥—åŒæ ·é€‚ç”¨ class ç»„ä»¶ğŸŸ, å¯é€šè¿‡ ref è°ƒç”¨å­ç»„ä»¶æ–¹æ³• --- //

```

> **ç”±äº å‡½æ•°å¼ ç»„ä»¶æ²¡æœ‰ç»„ä»¶å®ä¾‹, æ— æ³•é€šè¿‡ä»¥ä¸Šæ–¹æ³•è·å–ç»„ä»¶å®ä¾‹**
>
> ```js
> // è§£å†³
> 
> // é€šè¿‡ä¼ å‚æ–¹å¼ä¼ åˆ°å­ç»„ä»¶ç»‘å®š, éå¸¸ä¸æ¨è
> 
> // é€šè¿‡é«˜é˜¶å‡½æ•° forwardRef ä¼ å…¥ç»„ä»¶å‡½æ•°ä½œä¸ºå›è°ƒ, å¹¶ä¸”åœ¨ç¬¬äºŒä¸ªå‚æ•°ä¸­æ¥å— ref å¯¹ç»„ä»¶å†…å…ƒç´ è¿›è¡Œç»‘å®š
> import { forwardRef } from 'react'
> const Bpp = forwardRef(function(prop,ref){
> return (<div ref={ref}><div/>)
> })
> 
> <Bpp ref = {xxx}/>
> ```



#### 

#### å—æ§ç»„ä»¶ã€éå—æ§ç»„ä»¶

> å¦‚æœæŒ‡å®šäº† `value`, ä½†è¾“å…¥ä»å¯ç¼–è¾‘ï¼Œåˆ™å¯èƒ½æ˜¯æ„å¤–åœ°å°† `value` è®¾ç½®ä¸º `undefined` æˆ– `null`ï¼ˆè¾“å…¥æœ€åˆè¢«é”å®šï¼Œä½†åœ¨çŸ­æ—¶é—´å»¶è¿Ÿåå˜ä¸ºå¯ç¼–è¾‘ï¼‰

**å¦‚æœéœ€è¦å°†ä¸å¯ç¼–è¾‘çš„è½¬åŒ–ä¸ºä¸€ä¸ªå¯ç¼–è¾‘çš„, åˆ™éœ€è¦ä¸ºå…ƒç´ æ·»åŠ ä¸€ä¸ª onChang äº‹ä»¶, è¿›è¡ŒåŒå‘ç»‘å®š**

**`åœ¨ä¸€ä¸ªå—æ§ç»„ä»¶ä¸­ï¼Œè¡¨å•æ•°æ®æ˜¯ç”± React ç»„ä»¶æ¥ç®¡ç†çš„ã€‚å¦ä¸€ç§æ˜¯éå—æ§ç»„ä»¶ï¼Œè¿™æ—¶è¡¨å•æ•°æ®å°†äº¤ç”± DOM èŠ‚ç‚¹æ¥å¤„ç†ã€‚`**

```js
<input value={xxx} onChange={e => this.inputChange(e)} />
  
inputChange(e){
  e.targer.value
}


// 	å—æ§ç»„ä»¶
<input value={xxx} />
<input value={xxx} onChange={e => this.inputChange(e)}>
  
// 	éå—æ§ç»„ä»¶
<input type='text' />
//  éå—æ§ç»„ä»¶é»˜è®¤å€¼ or è·å– value, defaultValue å¯ä»¥ç»§ç»­è¾“å…¥ç¼–è¾‘
<input type='text' defaultValue={value} ref={input} />
  
// ğŸ¥ Array.from
const data = Array.from( ä¼ªæ•°ç»„, (item)=>item )
```



#### é«˜é˜¶ç»„ä»¶ 

**é«˜é˜¶å‡½æ•°ï¼šéœ€è¦æ»¡è¶³å¦‚ä¸‹æ¡ä»¶ä¹‹ä¸€**

- æ¥å—ä¸€ä¸ªæˆ–å¤šä¸ªå‡½æ•°ä½œä¸ºè¾“å…¥, å¦‚mapã€filterã€reduce...
- è¾“å‡ºä¸€ä¸ªå‡½æ•°, å¦‚æŸ¯é‡ŒåŒ–å‡½æ•°

**é«˜é˜¶ç»„ä»¶ç®€(HOC), å‚æ•°ä¸ºç»„ä»¶, è¿”å›å€¼ä¸ºä¸€ä¸ªæ–°ç»„ä»¶(æœ¬è´¨ä¸Šä¸æ˜¯ä¸€ä¸ªç»„ä»¶è€Œæ˜¯ä¸€ä¸ªå‡½æ•°), å¦‚ memoã€forwardRef**

```js
function newComponent(cpn){
  class NewCpn extends PureComponent{
    // ... cpn å¤„ç†
  }
  // ğŸ¥ class ç±»åå¯ä»¥é€šè¿‡ displayName æ¥ä¿®æ”¹
  NewCpn.displayName = "newComponent"
  return NewCpn
}

const newComponent = newComponent(<div></div>)
                                  
// é«˜é˜¶ç»„ä»¶ä¸å±äº React API çš„ä¸€éƒ¨ä»½, å®ƒæ˜¯åŸºäº React çš„ç»„åˆç‰¹æ€§è€Œå½¢æˆçš„è®¾è®¡æ¨¡å¼
// å®ƒåœ¨ä¸€äº› React ç¬¬ä¸‰æ–¹åº“ä¸­éå¸¸å¸¸è§
- redux çš„ connect
- react-router çš„ withRouter
```



**ä½¿ç”¨åœºæ™¯ä¸€ï¼šæ³¨å…¥æ•°æ®ã€æ•°æ®å…±äº«**

```js
function extInfo(cpn){
  class NewCpn extends PureComponent{
    constructor(){
      super()
      
      this.state={
        info:{
          a:'xxx',
          b:'yyy',
          c:'zzz'
        }
      }
    }
    render(){
      // ç»™ä¼ å…¥çš„ç»„ä»¶æ³¨å…¥ä¿¡æ¯
      return <cpn {...this.state.info} />
    }
  }
  return NewCpn
}

function App(props){
  return ...
}
function Bpp(props){
  return ...
}
  
const ExtApp = extInfo(App)
const ExtBpp = extInfo(Bpp)
const ExtCpp = extInfo(function(props){
  return <div>{props.a}</div>
})

// BUG å½“æ³¨å…¥åå†å¾€ç»„ä»¶ä¸Šæ·»åŠ å±æ€§å¦‚ä½•æ“ä½œ???
<ExtCpp value={value} />
  
// è§£å†³ğŸ¥
function extInfo(cpn){
  class NewCpn extends PureComponent{
    // ...
    render(){
      // å†æ·»åŠ ä¸€ä¸ª props å±æ€§å¾—ä»¥è§£å†³
      return <cpn { this.props } {...this.state.info} />
    }
  }
  return NewCpn
}
 
  
  
**æ¡ˆä¾‹**
import { createContext } from 'react'
const ThemeContext = createContext({color:'red',size:30})

// ... çœç•¥å®šä¹‰ context value

class App extends React.Component {
  // this.context è·å– value
  
  // ä½¿ç”¨å¤šä¸ª context æ–¹æ³•
  render(){
    return (
      <ThemeContext.Consumer>
      {
        value => <div>{value.color}</div>
      }
      </ThemeContext.Consumer>
    )
  }
}
App.ContextType = ThemeContext // è¿™ç§å®šä¹‰æ–¹æ³•åªèƒ½åœ¨ä¸€ä¸ªç»„ä»¶ä¸­ä½¿ç”¨ä¸€ä¸ª context

// ğŸ¶ä»¥ä¸Šåšæ³•å¤ªè¿‡æœºæ¢°é‡å¤æ“ä½œå¤ªå¤š, å¯ä»¥ä½¿ç”¨ é«˜é˜¶ç»„ä»¶ è¿›è¡Œä¼˜åŒ–
function Appï¼ˆcpnï¼‰{
  return props =>{
    return (
      <ThemeContext.Consumer>
      {
        value => <cpn {...value} {...props}>{value.color}</cpn>
      }
      </ThemeContext.Consumer>
    )
  }
}
```



**ä½¿ç”¨åœºæ™¯äºŒï¼š**

```js
// ä½¿ç”¨é«˜é˜¶ç»„ä»¶å¯¹ç»„ä»¶è¿›è¡Œé‰´æƒ, ç»Ÿä¸€åœ¨é«˜é˜¶ç»„ä»¶å†…éƒ¨è¿›è¡Œé‰´æƒ
function AuthOfCpn(cnp){
  // è·å– token ç­‰æƒé™æ ‡è¯†
  const isToken = ...
  return props=>(<div>{isToken?<cnp {...props} /> : 'è¯·å…ˆç™»é™†'}</div>)
}
```



> ##### forceUpdate(ä¸æ¨è)
>
>  ğŸ° **å¯ä½¿ç”¨`this.forceUpdate()`å¼ºåˆ¶åˆ·æ–°é¡µé¢**



**ä½¿ç”¨åœºæ™¯ä¸‰ï¼šç”Ÿå‘½å‘¨æœŸåŠ«æŒ**

```js
// è·å–ç»„ä»¶æ¸²æŸ“æ‰€éœ€çš„æ—¶é—´
class App extends React.PureComponent {
  // ç»„ä»¶å³å°†è¢«æŒ‚è½½ä¹‹å‰æ‰§è¡Œ(é€šå¸¸ä¸å»ºè®®ä½¿ç”¨)
  componentWillMount(){
    // è®°å½•æ—¶é—´æˆ³
  }
  // åŒ=äº, UNSAFE_componentWillMount(16.3è¢«å¼ƒç”¨)
  
  componentDidMount(){
    // è®¡ç®—æ—¶é—´å·®
  }
  render(){
    return (
      
    )
  }
}
```

> æ—©èµ· React ä¹Ÿæœ‰æä¾› Mixin è¿›è¡Œå¤ç”¨çš„, ä½†æ˜¯ç›®å‰å·²ç»ä¸å»ºè®®ä½¿ç”¨, å¯èƒ½ä¼šç›¸äº’ä¾èµ–ç›¸äº’è€¦åˆä¸åˆ©äºä»£ç ç»´æŠ¤ã€ç›¸äº’å†²çªæ–¹æ³•å±æ€§, å¤„ç†éº»çƒ¦



> ç”±äº Mixin çš„ç¼ºç‚¹, å¯ä»¥ä½¿ç”¨ **é«˜é˜¶ç»„ä»¶ or Hook** ä»£æ›¿, å½“ç„¶é«˜é˜¶ç»„ä»¶ä¹Ÿæœ‰äº›ç¼ºç‚¹
>
> - éœ€è¦åœ¨åŸç»„ä»¶(å‚æ•°ç»„ä»¶)åŸºç¡€ä¸Šè¿›è¡ŒåŒ…è£¹åµŒå¥—è¿”å›, å¦‚æœå¤§é‡ä½¿ç”¨é«˜é˜¶ç»„ä»¶, å°±ä¼šäº§ç”Ÿéå¸¸å¤šçš„åµŒå¥—å…³ç³», è¿™è®©è°ƒè¯•å˜å¾—éå¸¸å›°éš¾
> - é«˜é˜¶ç»„ä»¶å¯ä»¥åŠ«æŒ Props, åœ¨ä¸éµå®ˆçº¦å®šæƒ…å†µä¸‹, å¯èƒ½ä¼šé€ æˆå†²çª

> **Hook çš„å‡ºç°è§£å†³ä»¥ä¸Šè¯¸å¤šé—®é¢˜, æ˜¯å¼€åˆ›æ€§çš„, å¦‚ this æŒ‡å‘ã€é«˜é˜¶ç»„ä»¶åµŒå¥—é—®é¢˜**



#### Portals

> **å°†å†…å®¹æ¸²æŸ“ç‹¬ç«‹äºçˆ¶ç»„ä»¶, ç”šè‡³æ˜¯ç‹¬ç«‹äºå½“å‰æŒ‚è½½åˆ°çœŸå®çš„ DOM(é»˜è®¤æŒ‚è½½åœ¨ id = â€˜rootâ€™ çš„ DOM ä¸Š), å¯ä»¥æ¸²æŸ“å­èŠ‚ç‚¹åœ¨ä¸åŒ DOM æ ‘ä¸­(å¦‚ root ä¹‹å¤–çš„ DOM)**

```js
// åœ¨ Vue3 ä¸­ä½¿ç”¨ teleport å®ç°

// Reac...
<div id='root'></div>
<div id='system'></div>


import React from "react";
import ReactDOM from "react-dom/client"; // æ³¨æ„å¯¼å‡ºè·¯å¾„Portals
import {Portals} from "react-dom;


// After 18.x
const app = ReactDOM.creatRoot(document.querSelector("#root"));
app.render(<App />);
class App extends React.PureComponent {
  
  render(){
    return (<div>
            <h1>ROOT</h1>		
            {createPortals(
                <h2>ROOT</h2>,
                document.querSelector("#system")
            )}
						</div>)
  }
}
```



#### Fragment ç‰‡æ®µ

> ç”¨äºä»£æ›¿æœ€å¤–å±‚åŒ…è£¹çš„ div(æ­¤ div æ˜¯å¤šä½™ä¸éœ€è¦çš„, åªä¸è¿‡åœ¨è¿”å›æ—¶å¦‚æœæ˜¯å¤šå±‚å…„å¼Ÿ èŠ‚ç‚¹æ—¶éœ€è¦è¿›è¡ŒåŒ…è£¹), Fragmentä¸ä¼šæ¸²æŸ“åˆ°çœŸå®çš„ DOM ä¸­, ç›¸å½“äº Vue Template
>
> ```js
> render(){
>     return (<Fragment>
>             <h1>ROOT</h1>		
>             {createPortals(
>                 <h2>ROOT</h2>,
>                 document.querSelector("#system")
>             )}
> 						</Fragment>
> 		)
> }
>   
> // Vue3 ä¸­åœ¨ template ä¹¦å†™ä»£ç æ—¶ä¸éœ€è¦ä¸€ä¸ªæ ¹èŠ‚ç‚¹åŒæ ·ä¹Ÿæ˜¯ä½¿ç”¨ Fragment, å½“å‘ç°ç»„ä»¶ä¸­æ²¡æœ‰æ ¹åŒ…è£¹æ—¶, Vue ä½¿ç”¨ Fragment å¯¹ç»„ä»¶è¿›è¡ŒåŒ…è£¹
> ```

> **Fragment è¯­æ³•ç³–ğŸ¬ï¼šç›´æ¥ä½¿ç”¨ç©ºçš„æ ‡ç­¾è¿›è¡ŒåŒ…è£¹ä¹Ÿæ˜¯ä¸€æ ·çš„ `<>...</>`**
>
> **æ³¨æ„âš ï¸ï¼š(Vue3 åœ¨ transition ç»„ä»¶ä¸­ä½¿ç”¨ä¼šå‡ºç°é—®é¢˜), ä¸æ˜¯æ‰€æœ‰åœ°æ–¹éƒ½èƒ½ä½¿ç”¨ Fragment çš„è¯­æ³•ç³–, å¦‚éœ€è¦åœ¨ <></> ä¸Šç»‘å®šå±æ€§ key...**



#### ä¸¥æ ¼æ¨¡å¼ StrictMode

> **StrictMode æ˜¯ä¸€ä¸ªç»„ä»¶**ç”¨æ¥çªå‡ºæ˜¾ç¤ºåº”ç”¨ç¨‹åºæ½œåœ¨çš„é—®é¢˜çš„æ ¹æ®, ä¸ Fargment ä¸€æ ·, å®ƒä¸ä¼šæ¸²æŸ“ä»»ä½• å¯è§çš„ UI, **å®ƒä¸ºå…¶åä»£å…ƒç´ è§¦å‘é¢å¤–çš„æ£€æŸ¥å’Œè­¦å‘Š**, **ä»…åœ¨å¼€å‘æ¨¡å¼ä¸‹è¿è¡Œ**
>
> ```js
> ReactDOM.createRoot(document.getElementById("root") as HTMLElement).render(
>   <React.StrictMode>
>     <App />
>   </React.StrictMode>
> );
> 
> // å½“å¼€å¯ä¹‹åå¦‚åœ¨ä»£ç ä¸­ä½¿ç”¨ UNSAFE_componentWillMount(16.3è¢«å¼ƒç”¨)ã€findDomNode, ä¼šåœ¨æ§åˆ¶å°ä¸­æŠ¥è­¦å‘Š
> ```
>
> **åœ¨ StrictMode ä¸‹, render() å°†æ‰§è¡Œä¸¤æ¬¡,å¹¶ä¸”åœ¨ä¸¤æ¬¡æ¸²æŸ“ä¹‹é—´,æ‰€æœ‰çš„ç”Ÿå‘½å‘¨æœŸéƒ½ä¼šè¢«è°ƒç”¨ä¸¤æ¬¡ã€‚è¿™ä½¿å¾—åœ¨å¼€å‘æ¨¡å¼ä¸‹æ›´å®¹æ˜“å‘ç°æ½œåœ¨çš„é—®é¢˜ã€‚ä½†æ˜¯,è¯·æ³¨æ„,è¿™äº›ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä»ç„¶åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡ã€‚**
>
> åœ¨ 18.x å, å®‰è£… dev å¼€å‘æ ¹æ®å, StrictMode ä¸‹ç¬¬äºŒæ¬¡æ˜¾ç¤ºçš„è¾“å‡ºå‘ˆç°ç°è‰²
>
> - è¯†åˆ«ä¸å®‰å…¨çš„ç”Ÿå‘½å‘¨æœŸ
> - æœ‰å…³ä½¿ç”¨è¿‡æ—¶å­—ç¬¦ä¸²ref APIçš„è­¦å‘Š(findDOMNode)
> - æœ‰å…³ä½¿ç”¨è¿‡æ—¶findDOMNode APIçš„è­¦å‘Š
> - æ£€æµ‹æ„å¤–çš„å‰¯ä½œç”¨
> - æ£€æµ‹è¿‡æ—¶çš„context API



#### è¿‡æ¸¡åŠ¨ç”»

ä½¿ç”¨å¦‚ `react-transition-group` åº“[ä½“ç§¯å°]å®Œæˆè¿‡æ¸¡åŠ¨ç”»(å‰èº«æ˜¯ React ä¸ºå¼€å‘è€…æä¾›çš„åŠ¨ç”»æ’ä»¶:`react-addons-css-transition-group`, æ–¹ä¾¿å®ç°ç»„ä»¶çš„ å…¥åœº å’Œ å‡ºåœº åŠ¨ç”»

å…¶å®ƒ:`react-Motion`ã€`react Spring`

```js
// react-transition-group ä¸»è¦åŒ…å«å››ä¸ªç»„ä»¶ï¼š
- Transitionï¼šä¸å¹³å°æ— å…³ã€ä¸ä¸€å®šè¦ç»“åˆ Css
- CssTransitionï¼šé€šå¸¸å‰ç«¯å¼€å‘ä½¿ç”¨æ­¤ç»„ä»¶, åŸºäº Transition æ„å»ºçš„
- SwitchTransitionï¼šä¸¤ä¸ªç»„ä»¶æ˜¾ç¤ºéšè—åˆ‡æ¢æ—¶ä½¿ç”¨æ­¤ç»„ä»¶, ç›¸å½“äº Vue çš„ modes å±æ€§
- TransitionGroupï¼šå°†å¤šä¸ªç»„ä»¶åŒ…è£¹å…¶ä¸­,ä¸€èˆ¬åº”ç”¨äºåˆ—è¡¨ä¸­
```



###### CssTransition

- in æ§åˆ¶æ˜¾ç¤ºéšè—
- className åŠ¨ç”»ç±»å
- timeout åŠ¨ç”»æ‰§è¡Œæ—¶é—´, å¿…å¡« - å†³å®šä½•æ—¶åˆ é™¤æ·»åŠ è¿‡æ¸¡ç±»å, è¿‡æ¸¡æ—¶é—´ç”± css æ§åˆ¶, å¯ä»¥æ˜¯ä¸€ä¸ªå¯¹è±¡ { appear:xxx,enter:xxx,... }
- unmountOnExit ç»„ä»¶éšè—æ—¶æ˜¯å¦å¯¹ç»„ä»¶è¿›è¡Œå¸è½½, å¿…å¡«
- key é…åˆ SwitchTransition ä½¿ç”¨æ—¶å¿…å¡«

é’©å­å‡½æ•°ï¼š

- onEnter åŠ å…¥ä¹‹å‰
- onEntering æ­£åœ¨æ‰§è¡ŒåŠ å…¥åŠ¨ç”»
- onEntered æ‰§è¡ŒåŠ å…¥ç»“æŸ
- onExit å¼€å§‹ç¦»å¼€ä¹‹å‰
- onExiting ...
- onExited ...

çŠ¶æ€ï¼šappearã€enterã€exit

ä¸‰ç§çŠ¶æ€:

1ã€å¼€å§‹çŠ¶æ€ï¼šå¯¹åº”ç±» -appearã€-enterã€exit

2ã€æ‰§è¡ŒåŠ¨ç”»ï¼šå¯¹åº”ç±» -appear-activeã€-enter-activeã€-exit-active

3ã€æ‰§è¡Œç»“æŸï¼šå¯¹åº”ç±» -appear-doneã€-enter-doneã€-exit-active

```css
// åŠ å…¥æ—¶çš„åŠ¨ç”» in = true
.class-enter{
  opacity:0
}

.class-enter-active{
  opacity:1;
  transition:opacity 1s;
}
// ä»¥ä¸Šä¸¤æ­¥æ˜¯æ ¸å¿ƒ

.class-enter-done{
  // ...
}

// æ¨å‡ºæ—¶çš„åŠ¨ç”» in = false
.class-active{
  opacity:1
}

.class-enter-active{
  opacity:0;
  transition:opacity 1s;
}
// ä»¥ä¸Šä¸¤æ­¥æ˜¯æ ¸å¿ƒ

.class-active-done{
  // ...
}
```



**è§£å†³ä¸å…³é—­ StrictMode ä¸‹ CssTransition æŠ¥ findDOMNode é”™è¯¯(å…¶å®ƒç»„ä»¶åŒç†)**

```js
this.refValue = createRef()

<CssTransition
// ...
nodeRef={ this.refValue } // èµ‹å€¼åˆ°ç»„ä»¶çš„ nodeRef
>
  <div ref={ this.refValue }></div> // ç»‘å®š ref
</CssTransition>
```



###### SwitchTransition

ä¸ Vue çš„ mode å±æ€§ç›¸ä¼¼, æ§åˆ¶ä¸¤ä¸ªç»„ä»¶ä¹‹é—´çš„åˆ‡æ¢, å…ˆå‡ºåè¿›(out-in) or å…ˆè¿›åå‡º(in-out), éœ€è¦åŒ…è£¹ CSSTransition ä½¿ç”¨

```js
 render() {
    const { logo } = this;
    const { isGo } = this.state;
    const { slot } = this.props;
    console.log(slot);

    return (
      <>
        <button onClick={this.handleState}>{isGo ? "NO" : "OFF"}</button>
        <SwitchTransition mode="out-in">
          // åŸºäº CSSTransition, CSSTransition key å¿…å¡«ä¸€ä¸ªå”¯ä¸€çš„
          // ä¸éœ€è¦è®¾ç½® in
          <CSSTransition nodeRef={logo} key={isGo ? "ok" : "fail"} classNames="with" timeout={2000}>
            <div ref={logo}>
              <div>{isGo ? slot.react() : slot.vite()}</div>
              <h1>{isGo ? "React" : "Vite"}</h1>
            </div>
          </CSSTransition>
        </SwitchTransition>
      </>
    );
  }
```

```js
// memo é«˜é˜¶ç»„ä»¶ç¬¬äºŒå‚æ•°æ˜¯ä¸ªå‡½æ•°, åŒæ ·å¯ä»¥è‡ªå®šä¹‰åˆ¤æ–­æ˜¯å¦éœ€è¦æ›´æ–°
function memo<Props>(
  type: React$ElementType,
  compare?: (oldProps: Props, newProps: Props) => boolean,
) 

// å…³äºç»„ä»¶æ›´æ–°çš„, æ­£ç¡®åº”è¯¥åœ¨å‡½æ•°å¤–éƒ¨å®šä¹‰ğŸ“
const slot = {
  vite: "/vite.svg",
  react: reactLogo,
};
function App() {
  const [count, setCount] = useState(0);
	// è¿™é‡ŒåŒç†, å‡½æ•°é‡æ–°æ‰§è¡Œ, slot é‡æ–°ä¿®æ”¹åœ°å€å€¼
  return (
    <div className="App">
      <Home slot={/* è¿™é‡Œä¸èƒ½ç›´æ¥ä¹¦å†™ä¸€ä¸ªå¯¹è±¡, å¦åˆ™å½“ App æ›´æ–°, slot é‡æ–°è¢«èµ‹å€¼, åœ°å€å€¼åŒæ ·æ”¹å˜, å­ç»„ä»¶åŒæ ·æ›´æ–° */}></Home>

    </div>
  );
}
```



###### TransitionGroup

TransitionGroup é»˜è®¤æœ€ç»ˆæ¸²æŸ“å‡ºæ¥çš„æ˜¯ä¸€ä¸ª div æ ‡ç­¾, å®ƒçš„å­ç»„ä»¶å¯ä»¥æ˜¯ `CSSTransition` æˆ– `Transition` ç­‰è¿‡æ¸¡ç»„ä»¶

å±æ€§ï¼š

- component å®šä¹‰ TransitionGroup æ¸²æŸ“æˆä»€ä¹ˆå…ƒç´ 

```js
render() {
  return (
      <>
        <button onClick={this.handleAdd}>æ–°å¢</button>
        <button onClick={this.handleDelete}>åˆ é™¤</button>
        <TransitionGroup>
          {this.state.list.map(({ name = "", id = "" }, index: number) => {
            return (
              <CSSTransition timeout={2000} classNames="group" key={id}>
                // åœ¨ li é‡Œå®šä¹‰ transitionDelay å…¶å€¼ä¸ºå½“å‰å…ƒç´ çš„ç´¢å¼•ä¹˜ä»¥ 100 æ¯«ç§’ï¼Œè¡¨ç¤ºå‰ä¸€ä¸ªå…ƒç´ å®ŒæˆåŠ¨ç”»åï¼Œç­‰å¾…ä¸€å®šæ—¶é—´åå†å¼€å§‹åŠ¨ç”»
                <li style={{ transitionDelay: `${100 * index}ms` }}>
                  {name} - {id}
                </li>
              </CSSTransition>
            );
          })}
        </TransitionGroup>
      </>
    );
  }
```

#### å¦‚ä½•ç¼–å†™ CSS

CSS çš„è®¾è®¡ä¸æ˜¯ä¸ºç»„ä»¶åŒ–è€Œç”Ÿçš„, åœ¨ç»„ä»¶åŒ–ä¸­é€‰æ‹©åˆé€‚çš„ CSS è§£å†³æ–¹æ¡ˆåº”è¯¥ç¬¦åˆä»¥ä¸‹æ¡ä»¶ï¼š



- æ‹¥æœ‰å±€éƒ¨ä½œç”¨åŸŸçš„ css, ä¸ä¼šæ±¡æŸ“å…¶å®ƒç»„ä»¶çš„æ ·å¼
- å¯ä»¥ç¼–å†™åŠ¨æ€çš„ css, å¯ä»¥è·å¾—å½“å‰ç»„ä»¶çš„ä¸€äº›çŠ¶æ€, æ ¹æ®çŠ¶æ€ç”Ÿæˆä¸åŒçš„æ ·å¼
- æ”¯æŒåŸå£° css æ‰€æœ‰ç‰¹æ€§, åŠ¨ç”»ã€ä¼ªç±»ã€åª’ä½“æŸ¥è¯¢...
- ç¼–å†™æ–¹ä¾¿

###### å†…è”æ ·å¼

**JSX ä¸æ”¯æŒç›´æ¥åœ¨å†…è” style ä¸­ä½¿ç”¨å­—ç¬¦ä¸² ,éœ€è¦ä½¿ç”¨å¯¹è±¡çš„å˜é‡å½¢å¼(ğŸ›Ÿ)**

- å¯¹è±¡å±æ€§éœ€è¦ä»¥é©¼å³°å‘½å, ä¸æ”¯æŒåŸç”Ÿ -(font-size) å†™æ³•
- æ— æ³•ç¼–å†™æŸäº›æ ·å¼å†™æ³•(ä¼ªç±»ã€ä¼ªå…ƒç´ ), js ä¸­æ²¡æœ‰ css æ ·å¼æç¤º
- ä»£ç æ··ä¹±, åœ¨ js ä¸­ç¼–å†™æ ·å¼

###### CSS Module

CSS Module å¹¶ä¸æ˜¯ React ç‰¹æœ‰çš„è§£å†³æ–¹æ¡ˆ, è€Œæ˜¯æ‰€æœ‰ä½¿ç”¨äº†ç±»ä¼¼ webpack çš„æ‰“åŒ…æ„å»ºå·¥å…·çš„é…ç½®ç¯å¢ƒä¸‹éƒ½å¯ä»¥ä½¿ç”¨, å¦‚æœåœ¨å…¶å®ƒé¡¹ç›®æ„å»ºå·¥å…·ä¸­ä½¿ç”¨å®ƒ, åˆ™éœ€è¦è¿›è¡Œé…ç½®, å¦‚ï¼šwebpack.config.js `modules:true`

**React è„šæ‰‹æ¶å’Œ Vite é»˜è®¤å†…ç½®è¯¥é…ç½®ï¼š**

**.cssã€.scssã€.less ç­‰æ ·å¼æ–‡ä»¶éƒ½éœ€è¦ä¿®æ”¹æˆ .module.cssã€.module.scssã€...,  ä¹‹åå¼•ç”¨è¿›è¡Œä½¿ç”¨**

ä»»ä½•ä»¥ `.module.css` ä¸ºåç¼€åçš„ CSS æ–‡ä»¶éƒ½è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ª CSS Moduleã€‚å¯¼å…¥è¿™æ ·çš„æ–‡ä»¶ä¼šè¿”å›ä¸€ä¸ªç›¸åº”çš„æ¨¡å—å¯¹è±¡

```css
/* example.module.css */
.red {
  color: red;
}


// App.tsx
import classes from './example.module.css'
<div className={classes.red}></div>

// æœ€ç»ˆç”Ÿæˆ æ–‡ä»¶åç§°_ç±»å_å“ˆå¸Œå€¼ - ä¿è¯å”¯ä¸€æ€§
<div class="App_red_42Iui"></div>
```

**ğŸ‡ CSS Module é€‚ç”¨äºç¼–å†™æ™®é€šçš„ css æ ·å¼**

CSS Module ç¼ºç‚¹ï¼š

- js ä¸­å¼•ç”¨çš„ç±»åä¸èƒ½ä½¿ç”¨è¿æ¥ç¬¦(-,.red-color) js ä¸è¯†åˆ«
- æ‰€æœ‰ className éƒ½å¿…é¡»ä½¿ç”¨ `{style.className}çš„å½¢å¼ç¼–å†™`
- ä¸æ–¹ä¾¿åŠ¨æ€ä¿®æ”¹æ ·å¼, ä¾ç„¶ä½¿ç”¨å†…è”æ ·å¼åŠ¨æ€ä¿®æ”¹

> Vite ğŸ¥¥
>
> å¦‚æœ `css.modules.localsConvention` è®¾ç½®å¼€å¯äº† camelCase æ ¼å¼å˜é‡åè½¬æ¢ï¼ˆä¾‹å¦‚ `localsConvention: 'camelCaseOnly'`ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨æŒ‰åå¯¼å…¥
>
> ```js
> // .apply-color -> applyColor(é©¼å³°è½¬åŒ–)
> import { applyColor } from './example.module.css'
> document.getElementById('foo').className = applyColor
> ```



###### CSS in JS

**â€˜CSS in JSâ€™æ˜¯æŒ‡ä¸€ç§æ¨¡å¼, CSS ç”± JS ç”Ÿæˆ, è€Œä¸æ˜¯åœ¨å¤–éƒ¨æ–‡ä»¶å®šä¹‰(ä¸æ˜¯ React çš„ä¸€éƒ¨ä»½, è€Œæ˜¯ç”±ç¬¬ä¸‰æ–¹åº“æä¾›)**

> React è®¤ä¸º UI(HTML) ä»£ç å’Œä¸šåŠ¡é€»è¾‘(JavaScript)ä»£ç æ˜¯å¾ˆéš¾åˆ†ç¦»çš„, æ‰€ä»¥ React é€‰æ‹©å°† UI ä»£ç å’Œä¸šåŠ¡é€»è¾‘ä»£ç æ”¾åœ¨ä¸€èµ·, é€šè¿‡ JSX è¯­æ³•æ¥æè¿° UI , é€šè¿‡ JavaScript è¯­æ³•æ¥æè¿°ä¸šåŠ¡é€»è¾‘, æ ·å¼ä¹Ÿæ˜¯ UI çš„ä¸€éƒ¨ä»½, æ‰€ä»¥ä¹Ÿå†™è¿› jsx ä¸­(All in JS)

**ä½¿ç”¨`styled-components`åº“è¿›è¡Œ css in js å¼€å‘**

**css in js é€šè¿‡ js èµ‹äºˆ css æ›´å¤šçš„èƒ½åŠ›, å¦‚ï¼šç±»ä¼¼é¢„å¤„ç†å™¨ä¸€æ ·çš„æ ·å¼åµŒå¥—ã€å‡½æ•°å®šä¹‰ã€é€»è¾‘æœç”¨ã€åŠ¨æ€ä¿®æ”¹çŠ¶æ€ç­‰, é€šè¿‡ js ä»£ç æ¥èµ‹äºˆ, è™½ç„¶ css é¢„å¤„ç†å™¨åŒæ ·å…·å¤‡ä»¥ä¸Šä¸ªåˆ«èƒ½åŠ›, ä½†æ˜¯è·å–åŠ¨æ€çŠ¶æ€ä¾ç„¶ä¸æ˜¯å¾ˆå¥½å¤„ç†**(ç›®å‰æ¥è¯´è¯¥æ–¹æ¡ˆæ˜¯æœ€å—æ¬¢è¿)

> **styled.div`` æ˜¯è°ƒç”¨å‡½æ•°çš„å¦å¤–ä¸€ç§å†™æ³• == styled.div()**
>
> css in js åŒæ ·é€‚ç”¨ css é¢„å¤„ç†å™¨çš„å†™æ³•

```js
import styled from "styled-components";

// styled.div æ˜¯ä¸€ä¸ªè¿”å›React div ç»„ä»¶çš„å‡½æ•°(æ ‡ç­¾æ¨¡æ¿å­—ç¬¦ä¸²)
const HomeWrapper = styled.div`
  width: 100%;
  // ç»™å­å®šä¹‰æ ·å¼
  .p-box{
  	color:red;
  	&ï¼šhover{
  		font-size:22px;
  	}
  }
`;

<div>
  CSS in JS
	<p className="p-box"></p> // å­æ ·å¼åŒæ ·å¯ä»¥ä½¿ç”¨
</div>
// æ›¿æ¢ä¸º:          --- å°† div æ ‡ç­¾æ›¿æ¢ä¸º styled.div`` è¿”å›çš„ç»„ä»¶ 
<HomeWrapper>CSS in JS</HomeWrapper>

// fun`react is ${name} in all, .e.g. ${value} is a framework`
// è¾“å‡º:[
//     [ 'react is ', ' in all, .e.g. ', ' is a framework' ],
//     name,
//     value
//     ]
// ä»¥æ’å…¥çš„å˜é‡ä½ç½®å¯¹å­—ç¬¦ä¸²è¿›è¡Œåˆ†å‰²

```

###### æ¥æ”¶ä¼ å…¥çš„ props

css in js å¯ä»¥æ¥å—ç”±å¤–éƒ¨ä¼ å…¥çš„ props, å¦‚:

**`<HomeWrapper color={color} size={size}>CSS in JS</HomeWrapper>`**

**- é€šè¿‡ attrs ç»™æ¨¡æ¿å±æ€§æä¾›é»˜è®¤å€¼**

**- é€šè¿‡å®šä¹‰ variables.ts å®šä¹‰ç»Ÿä¸€çš„å˜é‡é£æ ¼(æ¨è)**

**- æ”¯æŒæ ·å¼ç»§æ‰¿**

**ä½¿ç”¨ styled-components - ThemeProvider åœ¨æœ€é¡¶å±‚å®šä¹‰å˜é‡è¿›è¡Œä¼ é€’ç»§æ‰¿**

```js
const HomeWrapper = styled.div`
  // ä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²ä¼ å…¥ä¸€ä¸ªå›è°ƒå‡½æ•°å¹¶æ¥æ”¶ä¸€ä¸ª porps å½¢å‚
  width: `${porps=>props.size}px`;
  
`;

// attrs å®šä¹‰ä¼ å…¥ js å˜é‡çš„é»˜è®¤å€¼
const HomeWrappe = styled.div.attrs(props=>({
  size:props.size || 50
}))`
  width: `${porps=>props.size}px`;
`
  
  
// variables.ts
export const appBg = '#ffc673'

// styled æ–‡ä»¶
import { appBg } from 'variables.ts'
const HomeWrappe = styled.div`
  color:`appBg`
`
  
  
// styled-components
import { ThemeProvider } from 'styled-components'

<ThemeProvider theme={{color:red}}>
	<App>
  	<Bpp />
  </App>
</ThemeProvider>

// Bpp.tsx styled
const BppStyled = styled.div`
	bpp{
		color:`${props=>props.theme.color}`
	}
`
    
    
// ç»§æ‰¿ HomeWrapper æ ·å¼ - ç»§æ‰¿ div ç»„ä»¶å±æ€§æ ·å¼ 
const Cpp = styled(HomeWrapper)`
color:xxx
// ç»§æ‰¿ width
`
```



###### classnames åº“

`pnpm add classnames`

ä¸ vue æ¨¡æ¿è¯­æ³•ç›¸ä¼¼:

- `classNames('foo',{bar:true})` // foo bar

- `classNames('foo',{bar:false})` // foo

- `classNames({foo:true},{bar:true})` // foo bar

- `classNames({foo:true,bar:true}) ` // foo bar

- `classNames(['aaa',{foo:true,bar:true}])`

- `classNames(null,false,undefind,0,1,{bar:null})` // 1

- ... ...

  ```js
  import _c from 'classnames'
  className={_c(xxx,{yyy:false})}
  ```

  

### Rudex çŠ¶æ€ç®¡ç†å™¨ä½¿ç”¨ ğŸ¥½

çº¯å‡½æ•°ï¼š

- ç¡®å®šçš„è¾“å…¥ä¸€å®šäº§ç”Ÿç¡®å®šçš„è¾“å‡º(å‡½æ•°ç›¸åŒçš„è¾“å…¥éœ€è¦äº§ç”Ÿç›¸åŒçš„è¾“å‡º)
- å‡½æ•°åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸èƒ½äº§ç”Ÿå‰¯ä½œç”¨

### React Router 6.x è·¯ç”±

### React Hook çš„ä½¿ç”¨ ğŸª‚

### React å®æˆ˜ ğŸ›´

### React é¡¹ç›®è‡ªåŠ¨åŒ–éƒ¨ç½²

```

```
